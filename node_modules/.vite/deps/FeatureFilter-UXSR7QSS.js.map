{
  "version": 3,
  "sources": ["../../@arcgis/core/views/2d/layers/features/support/whereUtils.js", "../../@arcgis/core/views/2d/layers/features/support/FeatureFilter.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Error.js\";import r from\"../../../../../core/Logger.js\";const t=r.getLogger(\"esri.views.2d.layers.features.support.whereUtils\"),a={getAttribute:(e,r)=>e.field(r)};async function s(r,s){const n=await import(\"../../../../../core/sql/WhereClause.js\");try{const o=n.WhereClause.create(r,s);if(!o.isStandardized){const r=new e(\"mapview - bad input\",\"Unable to apply filter's definition expression, as expression is not standardized.\",o);t.error(r)}return e=>{const r=e.readArcadeFeature();return o.testFeature(r,a)}}catch(o){return t.warn(\"mapview-bad-where-clause\",\"Encountered an error when evaluating where clause\",r),e=>!0}}export{s as createWhereClause};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../core/Error.js\";import e from\"../../../../../core/Logger.js\";import{create as i}from\"../../../../../geometry/support/aaBoundingRect.js\";import{getBoundsXY as s}from\"../../../../../geometry/support/boundsUtils.js\";import{getSpatialQueryOperator as r}from\"../../../../../layers/graphics/data/spatialQuerySupport.js\";import{getTimeOperator as o}from\"../../../../../layers/graphics/data/timeSupport.js\";import{normalizeQueryLike as h}from\"../../../../../layers/graphics/data/utils.js\";import a from\"../../../../../rest/support/Query.js\";import{featureAdapter as l}from\"../FeatureStore2D.js\";import{createWhereClause as n}from\"./whereUtils.js\";const d=1,m=2;class _{constructor(t){this._geometryBounds=i(),this._idToVisibility=new Map,this._serviceInfo=t}get hash(){return this._hash}check(t){return this._applyFilter(t)}clear(){const t=this._resetAllHiddenIds();return this.update(),{show:t,hide:[]}}invalidate(){this._idToVisibility.forEach(((t,e)=>{this._idToVisibility.set(e,0)}))}setKnownIds(t){for(const e of t)this._idToVisibility.set(e,d)}setTrue(t){const e=[],i=[],s=new Set(t);return this._idToVisibility.forEach(((t,r)=>{const o=!!(this._idToVisibility.get(r)&d),h=s.has(r);!o&&h?e.push(r):o&&!h&&i.push(r),this._idToVisibility.set(r,h?d|m:0)})),{show:e,hide:i}}createQuery(){const{geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r}=this;return a.fromJSON({geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r})}async update(t,e){this._hash=JSON.stringify(t);const i=await h(t,null,e);await Promise.all([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(t){if(!t||!t.where)return this._clause=null,void(this.where=null);this._clause=await n(t.where,this._serviceInfo.fieldsIndex),this.where=t.where}_setIdFilter(t){this._idsToShow=t&&t.objectIds&&new Set(t.objectIds),this._idsToHide=t&&t.hiddenIds&&new Set(t.hiddenIds),this.objectIds=t&&t.objectIds}async _setGeometryFilter(t){if(!t||!t.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const e=t.geometry,i=t.spatialRel||\"esriSpatialRelIntersects\",o=await r(i,e,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);s(this._geometryBounds,e),this._spatialQueryOperator=o,this.geometry=e,this.spatialRel=i}_setTimeFilter(i){if(this.timeExtent=this._timeOperator=null,i&&i.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=i.timeExtent,this._timeOperator=o(this._serviceInfo.timeInfo,i.timeExtent,l);else{const s=new t(\"feature-layer-view:time-filter-not-available\",\"Unable to apply time filter, as layer doesn't have time metadata.\",i.timeExtent);e.getLogger(\"esri.views.2d.layers.features.controllers.FeatureFilter\").error(s)}}_applyFilter(t){return this._filterByGeometry(t)&&this._filterById(t)&&this._filterByTime(t)&&this._filterByExpression(t)}_filterByExpression(t){return!this.where||this._clause(t)}_filterById(t){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(t.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(t.getObjectId()))}_filterByGeometry(t){if(!this.geometry)return!0;const e=t.readHydratedGeometry();return!!e&&this._spatialQueryOperator(e)}_filterByTime(t){return null==this._timeOperator||this._timeOperator(t)}_resetAllHiddenIds(){const t=[];return this._idToVisibility.forEach(((e,i)=>{e&d||(this._idToVisibility.set(i,d),t.push(i))})),t}}export{_ as default};\n"],
  "mappings": "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",
  "names": ["a", "s", "n", "r", "t", "i", "s"]
}
