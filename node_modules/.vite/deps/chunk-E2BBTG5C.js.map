{
  "version": 3,
  "sources": ["../../@arcgis/core/views/2d/tiling/TileQueue.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Accessor.js\";import{destroyMaybe as s}from\"../../../core/maybe.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import{subclass as o}from\"../../../core/accessorSupport/decorators/subclass.js\";import{d as i}from\"../../../chunks/vec2.js\";import{QueueProcessor as n}from\"../../support/QueueProcessor.js\";function u(e,t){return e.length=0,t.forEach((t=>e.push(t))),e}const c=new Set,a=[],h=new Map,l=[0,0];let p=class extends t{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy=\"scale-first\",this.tileInfoView=null}initialize(){const{concurrency:e,process:t,strategy:s}=this;this._queue=new n({concurrency:e,process:(e,s)=>{const r=this._keyToItem.get(e);return t(r,{signal:s})},peeker:\"scale-first\"===s?e=>this._peekByScaleFirst(e):e=>this._peekByCenterFirst(e)})}destroy(){this.clear(),this._queue=s(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const t=\"string\"==typeof e?e:e.id;this._queue.abort(t)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange(\"updating\")}has(e){return\"string\"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const t=\"string\"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)}pause(){this._queue.pause()}push(e){const t=e.key.id;if(this._queue.has(t))return this._queue.get(t);const s=this._queue.push(t),r=()=>{this._keyToItem.delete(t),this.notifyChange(\"updating\")};return this._keyToItem.set(t,e),s.then(r,r),this.notifyChange(\"updating\"),s}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView;let s=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;e.forEach((e=>{const t=this._keyToItem.get(e),o=this.tileInfoView.getTileScale(t.key);h.has(o)||(h.set(o,[]),s=Math.max(o,s),r=Math.min(o,r)),h.get(o).push(t.key),c.add(o)}));let o=this.state.scale;h.has(o)||(u(a,c),a.sort(((e,t)=>e-t)),o=a.reduce(((e,t)=>Math.abs(t-o)<Math.abs(e-o)?t:e),a[0])),o=Math.min(o,s),o=Math.max(o,r);const i=h.get(o),n=t.getClosestInfoForScale(o),l=n.getColumnForX(this.state.center[0]),p=n.getRowForY(this.state.center[1]);return i.sort(((e,t)=>{const s=n.denormalizeCol(e.col,e.world),r=n.denormalizeCol(t.col,t.world);return Math.sqrt((l-s)*(l-s)+(p-e.row)*(p-e.row))-Math.sqrt((l-r)*(l-r)+(p-t.row)*(p-t.row))})),c.clear(),h.clear(),i[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView,s=this.state.center;let r,o=Number.POSITIVE_INFINITY;return e.forEach((e=>{const n=this._keyToItem.get(e);t.getTileCoords(l,n.key);const u=i(l,s);u<o&&(o=u,r=n.key)})),r.id}};e([r({constructOnly:!0})],p.prototype,\"concurrency\",void 0),e([r({constructOnly:!0})],p.prototype,\"process\",void 0),e([r()],p.prototype,\"state\",void 0),e([r({constructOnly:!0})],p.prototype,\"strategy\",void 0),e([r({constructOnly:!0})],p.prototype,\"tileInfoView\",void 0),e([r({readOnly:!0})],p.prototype,\"updating\",null),p=e([o(\"esri.views.2d.tiling.TileQueue\")],p);const y=p;export{y as default};\n"],
  "mappings": "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",
  "names": ["u", "e", "t", "a", "l", "s", "o", "p", "r", "m", "y"]
}
