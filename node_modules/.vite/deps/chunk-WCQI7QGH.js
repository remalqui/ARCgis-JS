import {
  t as t2
} from "./chunk-MSLDEOHR.js";
import {
  t
} from "./chunk-B5TYSRH2.js";
import {
  b
} from "./chunk-PM3CFO6N.js";
import {
  v
} from "./chunk-T4XWQYGC.js";
import {
  j
} from "./chunk-HKVL2MJK.js";
import {
  L,
  V
} from "./chunk-O3CHVGVF.js";

// node_modules/@arcgis/core/rest/query/operations/queryTopFeatures.js
var u = "Layer does not support extent calculation.";
function l(t3, e) {
  var _a, _b;
  const r = t3.geometry, o = t3.toJSON(), i = o;
  if (null != r && (i.geometry = JSON.stringify(r), i.geometryType = v(r), i.inSR = r.spatialReference.wkid || JSON.stringify(r.spatialReference)), ((_a = o.topFilter) == null ? void 0 : _a.groupByFields) && (i.topFilter.groupByFields = o.topFilter.groupByFields.join(",")), ((_b = o.topFilter) == null ? void 0 : _b.orderByFields) && (i.topFilter.orderByFields = o.topFilter.orderByFields.join(",")), o.topFilter && (i.topFilter = JSON.stringify(i.topFilter)), o.objectIds && (i.objectIds = o.objectIds.join(",")), o.orderByFields && (i.orderByFields = o.orderByFields.join(",")), o.outFields && !((e == null ? void 0 : e.returnCountOnly) || (e == null ? void 0 : e.returnExtentOnly) || (e == null ? void 0 : e.returnIdsOnly)) ? o.outFields.includes("*") ? i.outFields = "*" : i.outFields = o.outFields.join(",") : delete i.outFields, o.outSR ? i.outSR = o.outSR.wkid || JSON.stringify(o.outSR) : r && o.returnGeometry && (i.outSR = i.inSR), o.returnGeometry && delete o.returnGeometry, o.timeExtent) {
    const t4 = o.timeExtent, { start: e2, end: r2 } = t4;
    null == e2 && null == r2 || (i.time = e2 === r2 ? e2 : `${e2 ?? "null"},${r2 ?? "null"}`), delete o.timeExtent;
  }
  return i;
}
async function y(t3, e, r, n) {
  const o = await a(t3, e, "json", n);
  return t2(e, r, o.data), o;
}
async function d(t3, e, r) {
  return null != e.timeExtent && e.timeExtent.isEmpty ? { data: { objectIds: [] } } : a(t3, e, "json", r, { returnIdsOnly: true });
}
async function p(t3, e, r) {
  return null != e.timeExtent && e.timeExtent.isEmpty ? { data: { count: 0, extent: null } } : a(t3, e, "json", r, { returnExtentOnly: true, returnCountOnly: true }).then((t4) => {
    const e2 = t4.data;
    if (e2.hasOwnProperty("extent"))
      return t4;
    if (e2.features)
      throw new Error(u);
    if (e2.hasOwnProperty("count"))
      throw new Error(u);
    return t4;
  });
}
function m(t3, e, r) {
  return null != e.timeExtent && e.timeExtent.isEmpty ? Promise.resolve({ data: { count: 0 } }) : a(t3, e, "json", r, { returnIdsOnly: true, returnCountOnly: true });
}
function a(n, s, u2, y2 = {}, d2 = {}) {
  const p2 = "string" == typeof n ? L(n) : n, m2 = s.geometry ? [s.geometry] : [];
  return y2.responseType = "pbf" === u2 ? "array-buffer" : "json", b(m2, null, y2).then((e) => {
    const n2 = e && e[0];
    null != n2 && ((s = s.clone()).geometry = n2);
    const o = t({ ...p2.query, f: u2, ...d2, ...l(s, d2) });
    return j(V(p2.path, "queryTopFeatures"), { ...y2, query: { ...o, ...y2.query } });
  });
}

export {
  y,
  d,
  p,
  m
};
//# sourceMappingURL=chunk-WCQI7QGH.js.map
