{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/support/featureLayerUtils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{id as t}from\"../../kernel.js\";import{symbolTypesRenderer as e}from\"../../symbols.js\";import r from\"../../core/Error.js\";import{JSONMap as n}from\"../../core/jsonMap.js\";import{parseWhereClause as o}from\"../../core/sql.js\";import{createTypeReader as s}from\"../../core/accessorSupport/extensions/serializableProperty/reader.js\";import{getOwningPortalUrl as a}from\"./layerUtils.js\";import i from\"../../renderers/SimpleRenderer.js\";import u from\"../../renderers/UniqueValueRenderer.js\";import c from\"../../rest/support/AttachmentQuery.js\";import p from\"../../rest/support/Query.js\";import l from\"../../rest/support/RelationshipQuery.js\";const d=new n({esriGeometryPoint:\"point\",esriGeometryMultipoint:\"multipoint\",esriGeometryPolyline:\"polyline\",esriGeometryPolygon:\"polygon\",esriGeometryMultiPatch:\"multipatch\"});async function y(t,e,n,o){const s=await C(t);if(await f(t,e,o),!s.addAttachment)throw new r(o,\"Layer source does not support addAttachment capability\");return s.addAttachment(e,n)}function f(t,e,n){const{attributes:o}=e,{objectIdField:s}=t;return t.get(\"capabilities.data.supportsAttachment\")?e?o?s&&o[s]?Promise.resolve():Promise.reject(new r(n,`feature is missing the identifying attribute ${s}`)):Promise.reject(new r(n,\"'attributes' are required on a feature to query attachments\")):Promise.reject(new r(n,\"A feature is required to add/delete/update attachments\")):Promise.reject(new r(n,\"this layer doesn't support attachments\"))}async function m(t,e,n,o,s){const a=await C(t);if(await f(t,e,s),!a.updateAttachment)throw new r(s,\"Layer source does not support updateAttachment capability\");return a.updateAttachment(e,n,o)}async function h(t,e,r){const{applyEdits:n}=await import(\"../graphics/editingSupport.js\"),o=await t.load();return n(o,o.source,e,r)}async function w(t,e,r){const{uploadAssets:n}=await import(\"../graphics/editingSupport.js\"),o=await t.load();return n(o,o.source,e,r)}async function b(t,e,n,o){const s=await C(t);if(await f(t,e,o),!s.deleteAttachments)throw new r(o,\"Layer source does not support deleteAttachments capability\");return s.deleteAttachments(e,n)}async function g(t,e,n){const o=(await t.load({signal:e?.signal})).source;if(!o.fetchRecomputedExtents)throw new r(n,\"Layer source does not support fetchUpdates capability\");return o.fetchRecomputedExtents(e)}async function j(t,e,n,o){e=c.from(e),await t.load();const s=t.source,a=t.capabilities;if(!a?.data?.supportsAttachment)throw new r(o,\"this layer doesn't support attachments\");const{attachmentTypes:i,objectIds:u,globalIds:p,num:l,size:d,start:y,where:f}=e;if(!a?.operations?.supportsQueryAttachments){if(i?.length>0||p?.length>0||d?.length>0||l||y||f)throw new r(o,\"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported\",e)}if(!(u?.length||p?.length||f))throw new r(o,\"'objectIds', 'globalIds', or 'where' are required to perform attachment query\",e);if(!s.queryAttachments)throw new r(o,\"Layer source does not support queryAttachments capability\",e);return s.queryAttachments(e)}async function q(t,e,n,o){const s=await C(t);if(!s.queryObjectIds)throw new r(o,\"Layer source does not support queryObjectIds capability\");return s.queryObjectIds(p.from(e)??t.createQuery(),n)}async function F(t,e,n,o){const s=await C(t);if(!s.queryFeatureCount)throw new r(o,\"Layer source does not support queryFeatureCount capability\");return s.queryFeatureCount(p.from(e)??t.createQuery(),n)}async function I(t,e,n,o){const s=await C(t);if(!s.queryExtent)throw new r(o,\"Layer source does not support queryExtent capability\");return s.queryExtent(p.from(e)??t.createQuery(),n)}async function P(t,e,n,o){const s=await C(t);if(!s.queryRelatedFeatures)throw new r(o,\"Layer source does not support queryRelatedFeatures capability\");return s.queryRelatedFeatures(l.from(e),n)}async function A(t,e,n,o){const s=await C(t);if(!s.queryRelatedFeaturesCount)throw new r(o,\"Layer source does not support queryRelatedFeaturesCount capability\");return s.queryRelatedFeaturesCount(l.from(e),n)}async function O(t){const e=t.source;if(e?.refresh)try{const{dataChanged:r,updates:n}=await e.refresh();if(null!=n&&(t.sourceJSON={...t.sourceJSON,...n},t.read(n,{origin:\"service\",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await o(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function E(t){const e=new p,r=t.get(\"capabilities.data\"),n=t.get(\"capabilities.query\");e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,n&&(e.compactGeometryEnabled=n.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=n.supportsDefaultSpatialReference),r&&(r.supportsZ&&null!=t.returnZ&&(e.returnZ=t.returnZ),r.supportsM&&null!=t.returnM&&(e.returnM=t.returnM)),e.outFields=[\"*\"];const{timeOffset:o,timeExtent:s}=t;return e.timeExtent=null!=o&&null!=s?s.offset(-o.value,o.unit):s||null,e.multipatchOption=\"multipatch\"===t.geometryType?\"xyFootprint\":null,e}function S(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r)for(const n of r)if(\"esriFieldTypeGlobalID\"===n.type)return n.name}function R(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r)for(const n of r)if(\"esriFieldTypeOID\"===n.type)return n.name}function x(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty(\"capabilities\")||t.hasOwnProperty(\"drawingInfo\")||t.hasOwnProperty(\"hasAttachments\")||t.hasOwnProperty(\"htmlPopupType\")||t.hasOwnProperty(\"relationships\")||t.hasOwnProperty(\"timeInfo\")||t.hasOwnProperty(\"typeIdField\")||t.hasOwnProperty(\"types\")?10:9.3}async function C(t){return(await t.load()).source}async function L(e,r){if(!t)return;if(t.findCredential(e))return;let n;try{const o=await a(e,r);o&&(n=await t.checkSignInStatus(`${o}/sharing`))}catch(o){}if(n)try{const n=null!=r?r.signal:null;await t.getCredential(e,{signal:n})}catch(o){}}async function M(t,e){const r=t.parsedUrl?.path;r&&G(t)&&await L(r,e)}function G(t){const e=t.editFieldsInfo;return!(!e?.creatorField&&!e?.editorField)||(t.userHasUpdateItemPrivileges?t.hasUpdateItemRestrictions:!!t.userHasFullEditingPrivileges&&t.hasFullEditingRestrictions)}function Q(t){return!t.sourceJSON?.isMultiServicesView&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const U=s({types:e});function v(t,e){if(t.defaultSymbol)return t.types&&t.types.length?new u({defaultSymbol:U(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map((t=>({id:t.id,symbol:U(t.symbol,t,e)})))}):new i({symbol:U(t.defaultSymbol,t,e)})}export{y as addAttachment,h as applyEdits,Q as computeEffectiveEditingEnabled,v as createDefaultRenderer,E as createQuery,b as deleteAttachments,M as ensureLayerCredential,g as fetchRecomputedExtents,d as geometryTypeKebabDict,O as hasDataChanged,j as queryAttachments,I as queryExtent,F as queryFeatureCount,q as queryObjectIds,P as queryRelatedFeatures,A as queryRelatedFeaturesCount,S as readGlobalIdField,R as readObjectIdField,x as readVersion,m as updateAttachment,w as uploadAssets};\n"],
  "mappings": "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",
  "names": ["d", "s", "e", "n", "h", "b", "u", "p", "y", "f", "A", "M", "t"]
}
