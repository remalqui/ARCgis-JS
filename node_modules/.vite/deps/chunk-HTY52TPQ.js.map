{
  "version": 3,
  "sources": ["../../@arcgis/core/rest/query/operations/query.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport t from\"../../../request.js\";import{urlToObject as e,join as n}from\"../../../core/urlUtils.js\";import{getJsonType as r}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as i}from\"../../../geometry/support/normalizeUtils.js\";import{mapParameters as a}from\"../../operations/urlUtils.js\";import{parsePBFFeatureQuery as o}from\"./pbfQueryUtils.js\";import{applyFeatureSetZUnitScaling as u}from\"./queryZScale.js\";const l=\"Layer does not support extent calculation.\";function s(t,e){if(e&&\"extent\"===t.type)return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&\"point\"===t.type)return`${t.x},${t.y}`;const n=t.toJSON();return delete n.spatialReference,JSON.stringify(n)}function y(t,e){const n=t.geometry,i=t.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const a=i;let o,u,l;if(null!=n&&(u=n.spatialReference,l=n.spatialReference.wkid||JSON.stringify(n.spatialReference),a.geometryType=r(n),a.geometry=s(n,t.compactGeometryEnabled),a.inSR=l),i.groupByFieldsForStatistics&&(a.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(\",\")),i.objectIds&&(a.objectIds=i.objectIds.join(\",\")),i.orderByFields&&(a.orderByFields=i.orderByFields.join(\",\")),!i.outFields||!i.returnDistinctValues&&(e?.returnCountOnly||e?.returnExtentOnly||e?.returnIdsOnly)?delete a.outFields:i.outFields.includes(\"*\")?a.outFields=\"*\":a.outFields=i.outFields.join(\",\"),i.outSR?(a.outSR=i.outSR.wkid||JSON.stringify(i.outSR),o=t.outSpatialReference):n&&(i.returnGeometry||i.returnCentroid)&&(a.outSR=a.inSR,o=u),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(a.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(a.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(a.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&null!=u&&null!=t.quantizationParameters&&null!=t.quantizationParameters.extent&&u.equals(t.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,a.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(a.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(a.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(a.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const t=i.timeExtent,{start:e,end:n}=t;null==e&&null==n||(a.time=e===n?e:`${e??\"null\"},${n??\"null\"}`),delete i.timeExtent}return t.defaultSpatialReferenceEnabled&&null!=u&&null!=o&&u.equals(o)&&(a.defaultSR=a.inSR,delete a.inSR,delete a.outSR),a}async function m(t,e,n,r){const i=null!=e.timeExtent&&e.timeExtent.isEmpty?{data:{features:[]}}:await x(t,e,\"json\",r);return u(e,n,i.data),i}async function c(t,e,n,r){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:n.createFeatureResult()};const i=await f(t,e,r),a=i;return a.data=o(i.data,n),a}function f(t,e,n){return x(t,e,\"pbf\",n)}function d(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):x(t,e,\"json\",n,{returnIdsOnly:!0})}function p(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):x(t,e,\"json\",n,{returnIdsOnly:!0,returnCountOnly:!0})}async function S(t,e,n){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:{count:0,extent:null}};const r=await x(t,e,\"json\",n,{returnExtentOnly:!0,returnCountOnly:!0}),i=r.data;if(i.hasOwnProperty(\"extent\"))return r;if(i.features)throw new Error(l);if(i.hasOwnProperty(\"count\"))throw new Error(l);return r}async function x(r,o,u,l={},s={}){const m=\"string\"==typeof r?e(r):r,c=o.geometry?[o.geometry]:[];l.responseType=\"pbf\"===u?\"array-buffer\":\"json\";const f=await i(c,null,l),d=f&&f[0];null!=d&&((o=o.clone()).geometry=d);const p=a({...m.query,f:u,...s,...y(o,s)});return t(n(m.path,E(o,s)?\"query3d\":\"query\"),{...l,query:{...p,...l.query}})}function E(t,e){return null!=t.formatOf3DObjects&&!(e.returnCountOnly||e.returnExtentOnly||e.returnIdsOnly)}export{s as encodeGeometry,m as executeQuery,p as executeQueryForCount,S as executeQueryForExtent,d as executeQueryForIds,c as executeQueryPBF,f as executeQueryPBFBuffer,y as queryToQueryStringParameters,x as runQuery};\n"],
  "mappings": "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",
  "names": ["t", "l", "e", "n", "s", "m", "c", "f", "d", "p"]
}
