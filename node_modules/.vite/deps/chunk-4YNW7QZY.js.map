{
  "version": 3,
  "sources": ["../../@arcgis/core/views/2d/tiling/TileCache.js", "../../@arcgis/core/views/2d/tiling/TileStrategy.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{k as e}from\"../../../chunks/vec2.js\";class t{constructor(e,t,i){this.maxSize=e,this._tileInfoView=t,this._removedFunc=i,this._tilePerId=new Map,this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear(),this._tileKeysPerLevel=[]}has(e){return this._tilePerId.has(e)}get(e){return this._tilePerId.get(e)}pop(e){const t=this._tilePerId.get(e);if(!t)return;const r=t.key.level,s=this._tileKeysPerLevel[r];i(this._tilePerId,e);for(let i=0;i<s.length;i++)if(s[i].id===e){s.splice(i,1);break}return t.visible=!0,t}add(e){e.visible=!1;const t=e.key,i=t.id;if(this._tilePerId.has(i))return;this._tilePerId.set(i,e);const r=t.level;this._tileKeysPerLevel[r]||(this._tileKeysPerLevel[r]=[]),this._tileKeysPerLevel[r].push(t)}prune(e,t,i){let r=this._tilePerId.size;if(r<=this.maxSize)return;let s=this._tileKeysPerLevel.length-1;for(;r>this.maxSize&&s>=0;)s!==e&&(r=this._pruneAroundCenterTile(r,t,i,s)),s--;r>this.maxSize&&(r=this._pruneAroundCenterTile(r,t,i,e))}_pruneAroundCenterTile(t,i,r,s){const l=this._tileKeysPerLevel[s];if(!l||0===l.length)return t;const{size:n,origin:h}=this._tileInfoView.tileInfo,o=r*n[0],_=r*n[1],d=[0,0],u=[0,0];for(l.sort(((t,r)=>(d[0]=h.x+o*(t.col+.5),d[1]=h.y-_*(t.row+.5),u[0]=h.x+o*(r.col+.5),u[1]=h.y-_*(r.row+.5),e(d,i)-e(u,i))));l.length>0;){const e=l.pop();if(this._removeTile(e.id),--t===this.maxSize)break}return t}_removeTile(e){const t=this._tilePerId.get(e);this._removedFunc&&t&&this._removedFunc(t),i(this._tilePerId,e)}}function i(e,t){e.delete(t)}export{t as default};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{create as e,contains as i}from\"../../../geometry/support/aaBoundingRect.js\";import t from\"./TileCache.js\";import s from\"./TileCoverage.js\";import l from\"./TileKey.js\";const o=new l(0,0,0,0),h=new Map,a=[],c=[];class r{constructor(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy=\"keep\",this.coveragePolicy=\"closest\",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,null!=e.resampling&&(this.resampling=e.resampling),e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),null!=e.buffer&&(this.buffer=e.buffer),e.cacheSize&&(this._tileCache=new t(e.cacheSize,this.tileInfoView,(e=>{this.releaseTile(e)})))}destroy(){this.tileIndex.clear()}update(e){const{resampling:i,tileIndex:t}=this,{scale:l,center:r,resolution:n}=e.state,{minScale:f,maxScale:d}=this.tileInfoView,u=!e.stationary&&l>this._previousScale;if(this._previousScale=l,!i&&(l>f||l<d))return this.tiles.length=0,void this.clear();const p=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.resampling,this.coveragePolicy);if(!p)return this.tiles.length=0,void this.clear();const{spans:y,lodInfo:g}=p,{level:I}=g;this.tiles.length=0,t.forEach((e=>e.visible=!0));let v=0,m=0;if(y.length>0)for(const{row:s,colFrom:a,colTo:c}of y)for(let e=a;e<=c;e++){v++;const i=o.set(I,s,g.normalizeCol(e),g.getWorldForColumn(e)).id;let l=t.get(i);if(l)l.isReady?(h.set(i,l),m++):u||this._addParentTile(i,h);else{if(this._tileCache?.has(i)){if(l=this._tileCache.pop(i),this.tileIndex.set(i,l),l.isReady){h.set(i,l),m++;continue}}else l=this.acquireTile(o),this.tileIndex.set(i,l);u||this._addParentTile(i,h)}}const T=m===v;for(const[s,_]of t){if(h.has(s))continue;o.set(s);const e=this.tileInfoView.intersects(p,o),i=\"purge\"===this.cachePolicy?o.level!==I:o.level>I;!e||!u&&T?!i&&e||a.push(_):_.isReady?i&&\"purge\"===this.cachePolicy&&this._hasReadyAncestor(o,I)?a.push(_):c.push(_):i&&a.push(_)}for(const s of c)s.isReady&&h.set(s.key.id,s);for(const s of a)this._tileCache?this._tileCache.add(s):this.releaseTile(s),t.delete(s.key.id);for(const s of h.values())this.tiles.push(s);for(const s of t.values())h.has(s.key.id)||(s.visible=!1);this._tileCache?.prune(I,r,n),s.pool.release(p),c.length=0,a.length=0,h.clear()}clear(){const{tileIndex:e}=this;for(const i of e.values())this.releaseTile(i);e.clear()}refresh(e){for(const i of this.tileIndex.values())this.tiles.includes(i)?e(i):a.push(i);for(const i of a)this.releaseTile(i),this.tileIndex.delete(i.key.id);this._tileCache?.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,i){let t=e,s=null;for(;t=this.tileInfoView.getTileParentId(t),t;)if(this.tileIndex.has(t)){if(s=this.tileIndex.get(t),s?.isReady){i.has(s.key.id)||i.set(s.key.id,s);break}}else if(this._tileCache?.has(t)&&(s=this._tileCache.pop(t),this.tileIndex.set(t,s),s?.isReady)){i.has(s.key.id)||i.set(s.key.id,s);break}}_hasReadyAncestor(t,s){const l=e();this.tileInfoView.getTileBounds(l,t,!0);for(const o of this.tileIndex.values())if(o.isReady&&o.key.level>=s&&o.key.level<t.level){const t=e();if(this.tileInfoView.getTileBounds(t,o.key,!0),i(t,l))return!0}return!1}}export{r as default};\n"],
  "mappings": "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",
  "names": ["e", "t", "i", "r", "l", "h", "o", "e", "i", "t", "l", "r", "a", "c", "o"]
}
