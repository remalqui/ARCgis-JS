/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../../chunks/tslib.es6.js";import e from"../../../../../core/Accessor.js";import{HandleOwner as i}from"../../../../../core/HandleOwner.js";import{rad2deg as l,deg2rad as n}from"../../../../../core/mathUtils.js";import{when as o,sync as r}from"../../../../../core/reactiveUtils.js";import{property as s}from"../../../../../core/accessorSupport/decorators/property.js";import"../../../../../core/accessorSupport/ensureType.js";import"../../../../../core/arrayUtils.js";import"../../../../../core/has.js";import{subclass as a}from"../../../../../core/accessorSupport/decorators/subclass.js";let c=class extends i{constructor(t){super(t),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(o((()=>null!=this._interactionState?this._interactionState.state:null),(t=>{this._updateSymbol(t)}),r))}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){return null!=this._interactionState?this._interactionState.angle:null!=this._orientationReferenceSymbolLayer?h(this._orientationReferenceSymbolLayer.heading??0):0}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}get size(){const t=this._sizeReferenceSymbolLayer;if(null==t)return null;const e=this.findLayerView(),i=this._graphicSymbol;if(null==e||null==i||"point-3d"!==i.type)return null;const l=e.getSymbolLayerSize(i,t);if("size"in l&&null!=l.size)return l.size;const n=this.sizeAxis;return!("width"in l)||null==l.width||null!=n&&"width"!==n&&"all"!==n&&"width-and-depth"!==n?!("depth"in l)||null==t.depth||null!=n&&"depth"!==n&&"all"!==n&&"width-and-depth"!==n?!("height"in l)||null==t.height||null!=n&&"height"!==n&&"all"!==n?null:l.height:l.depth:l.width}get _sizeReferenceSymbolLayer(){const t=this._graphicSymbol;return null==t||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type))}get _orientationReferenceSymbolLayer(){const t=this._graphicSymbol;return null==t||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type&&null!=t.heading))}get _graphicSymbol(){return null!=this.graphic&&null!=this.graphic.symbol&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(t){this.graphic.symbol=t}startInteraction(){const t=this._graphicSymbol,e=this.findLayerView();if(null!=this._interactionState||null==t||null==e)return p;const i=t.symbolLayers.map((i=>"object"===i.type?e.getSymbolLayerSize(t,i):null)).toArray(),l=t.clone(),n=this.angle,o=new y({originalSymbol:l,angle:n,initialSizes:i});this._interactionState=o;const r=()=>{this._interactionState=null};return{state:o,done:r,cancel:()=>{this._graphicSymbol=l,r()}}}createUndoRecord(){let t=this.graphic.symbol,e=null;return{undo:i=>{e=i.symbol,i.symbol=t},redo:i=>{t=i.symbol,i.symbol=e}}}_updateSymbol({scale:t,angle:e,originalSymbol:i,initialSizes:n}){const o=this._graphicSymbol;if(null==o||"point-3d"!==o.type)return;const r=o.clone(),s=-l(e-this.initialAngle);let a=!1;this._forEachObjectSymbolLayerPair(i,r,((e,i,l)=>{const o=(e.heading??0)+s;i.heading!==o&&(i.heading=o,a=!0);const r=n[l];if(null!=r&&"width"in r){r.width=this.sizeFilter(r.width),r.height=this.sizeFilter(r.height),r.depth=this.sizeFilter(r.depth);const e=r.width*t;i.width!==e&&(i.width=e,a=!0);const l=r.depth*t;i.depth!==l&&(i.depth=l,a=!0);const n=r.height*t;i.height!==n&&(i.height=n,a=!0)}})),a&&(this._graphicSymbol=r)}_forEachObjectSymbolLayerPair(t,e,i){t.symbolLayers.forEach(((t,l)=>{const n=e.symbolLayers.at(l);"object"===t.type&&"object"===n.type&&i(t,n,l)}))}};function h(t){return-n(t)}t([s()],c.prototype,"initialAngle",null),t([s()],c.prototype,"angle",null),t([s()],c.prototype,"angleClockwise",null),t([s()],c.prototype,"orientation",null),t([s()],c.prototype,"orientationClockwise",null),t([s()],c.prototype,"relativeAngle",null),t([s()],c.prototype,"relativeAngleClockwise",null),t([s()],c.prototype,"scale",null),t([s()],c.prototype,"size",null),t([s()],c.prototype,"sizeAxis",void 0),t([s({constructOnly:!0})],c.prototype,"graphic",void 0),t([s()],c.prototype,"_interactionState",void 0),t([s({constructOnly:!0})],c.prototype,"findLayerView",void 0),t([s({constructOnly:!0})],c.prototype,"sizeFilter",void 0),t([s()],c.prototype,"_sizeReferenceSymbolLayer",null),t([s()],c.prototype,"_orientationReferenceSymbolLayer",null),t([s()],c.prototype,"_graphicSymbol",null),c=t([a("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],c);const p={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let y=class extends e{get state(){const{originalSymbol:t,angle:e,initialAngle:i,scale:l,initialSizes:n}=this;return{originalSymbol:t,angle:e,initialAngle:i,scale:l,initialSizes:n}}constructor(t){super(t),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=t.angle}};t([s()],y.prototype,"originalSymbol",void 0),t([s()],y.prototype,"angle",void 0),t([s()],y.prototype,"initialAngle",void 0),t([s()],y.prototype,"initialSizes",void 0),t([s()],y.prototype,"scale",void 0),t([s()],y.prototype,"state",null),y=t([a("InteractionState")],y);export{c as ScaleRotateObjectSymbol3DAdapter,h as headingToAngle};
