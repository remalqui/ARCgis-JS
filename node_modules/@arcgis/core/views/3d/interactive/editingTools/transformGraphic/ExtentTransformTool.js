/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../../chunks/tslib.es6.js";import e from"../../../../../core/Evented.js";import i from"../../../../../core/Handles.js";import{makeHandle as a}from"../../../../../core/handleUtils.js";import{rad2deg as s}from"../../../../../core/mathUtils.js";import{createLength as o}from"../../../../../core/quantityUtils.js";import{watch as r,initial as n}from"../../../../../core/reactiveUtils.js";import{screenPointObjectToArray as p}from"../../../../../core/screenUtils.js";import{lengthUnitFromSpatialReference as l,getMetersPerUnitForSR as h}from"../../../../../core/unitUtils.js";import{property as c}from"../../../../../core/accessorSupport/decorators/property.js";import"../../../../../core/accessorSupport/ensureType.js";import"../../../../../core/arrayUtils.js";import"../../../../../core/has.js";import{subclass as u}from"../../../../../core/accessorSupport/decorators/subclass.js";import{o as d}from"../../../../../chunks/mat4.js";import{s as m,c as _,e as g}from"../../../../../chunks/vec2.js";import{a as y}from"../../../../../chunks/vec2f64.js";import{c as v,A as f,b as S,n as M,l as b,e as T}from"../../../../../chunks/vec3.js";import{c as x,a as E}from"../../../../../chunks/vec3f64.js";import{containsXY as A}from"../../../../../geometry/support/aaBoundingRect.js";import{a as B,c as O}from"../../../../../chunks/boundedPlane.js";import{intersectRay as j,create as R,normal as G}from"../../../../../geometry/support/plane.js";import{create as D}from"../../../../../geometry/support/ray.js";import{sv2d as w,sv3d as P,sm4d as z}from"../../../../../geometry/support/vectorStacks.js";import{getGraphicEffectiveElevationInfo as U}from"../../../../../support/elevationInfoUtils.js";import{createShiftManipulator as I,OffsetMode as Z,IsShiftEdgeOnScreenFlag as C,createResizeManipulator as k,resizeNormal as L,resizeOutlineOnly as X,isDiagonalResizeHandle as Y,calculateDiagonalResizeHandleScale as N,createRotatePlane as V,RotationAxis as H,calculateBoundedPlaneTranslateRotate as F,updateRotateHeadingHandle as q,updateResizeHandle as W}from"../../../analysis/Slice/sliceToolUtils.js";import{getRotateHeadingTexture as J}from"../../../analysis/Slice/images/Factory.js";import{Manipulator3D as K}from"../../Manipulator3D.js";import{createRotateManipulator as Q,getGraphicAttachmentOrigin as $,calculateInputRotationTransform as tt}from"../../manipulatorUtils.js";import{screenToZConstrained as et,screenToRenderPlane as it}from"../dragEventPipeline3D.js";import{ManipulatorType as at}from"../ManipulatorType.js";import{canMoveZ as st}from"../manipulatorUtils.js";import{getSettings as ot}from"../settings.js";import{createVisualElements as rt}from"../visualElementUtils.js";import{ManipulationType as nt}from"../manipulations/MoveManipulation.js";import{MoveXYGraphicManipulation as pt}from"../manipulations/MoveXYGraphicManipulation.js";import{PreserveAspectRatio as lt}from"./PreserveAspectRatio.js";import{OutlineVisualElement as ht}from"../../visualElements/OutlineVisualElement.js";import{evaluateElevationAlignmentAtPoint as ct}from"../../../layers/graphics/elevationAlignmentUtils.js";import{ElevationContext as ut}from"../../../layers/graphics/ElevationContext.js";import{GraphicState as dt}from"../../../layers/graphics/GraphicState.js";import{fromScreen as mt}from"../../../support/geometryUtils/ray.js";import{createManipulatorDragEventPipeline as _t,addMapDelta as gt,addScreenDelta as yt}from"../../../../interactive/dragEventPipeline.js";import{InteractiveToolBase as vt}from"../../../../interactive/InteractiveToolBase.js";import{EditGeometryOperations as ft}from"../../../../interactive/editGeometry/EditGeometryOperations.js";import{AccumulationBehaviour as St}from"../../../../interactive/editGeometry/interfaces.js";import{AccumulationType as Mt}from"../../../../interactive/editGeometry/operations/UpdateVertices.js";import{mapPlaneAutoHorizontalSizeByElevationMode as bt,calculateOrientedBounds as Tt,mapPlaneToRenderPlane as xt,apply as Et,unapply as At}from"../../../../interactive/editGeometry/support/editPlaneUtils.js";import Bt from"../../../../interactive/sketch/SketchTooltipOptions.js";import{ExtentRotateTooltipInfo as Ot,ExtentScaleTooltipInfo as jt}from"../../../../interactive/tooltip/ExtentTooltipInfos.js";import{Tooltip as Rt}from"../../../../interactive/tooltip/Tooltip.js";import{TranslateGraphicTooltipInfo as Gt,TranslateGraphicZTooltipInfo as Dt}from"../../../../interactive/tooltip/TranslateTooltipInfos.js";import{autoHorizontalDistanceByElevationModeBetweenPoints as wt}from"../../../../support/automaticLengthMeasurementUtils.js";import{multiplyOpacity as Pt,unitRGBAFromColor as zt}from"../../../../support/colorUtils.js";import{verticalSignedDistance as Ut}from"../../../../support/euclideanLengthMeasurementUtils.js";let It=class extends(e.EventedMixin(vt)){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Bt,this._preserveAspectRatio=new lt,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this._handles=new i,this._attachmentOrigin=null,this._outlineVisualElement=null,this._mapBounds=B(),this._mapBoundsStart=B(),this._zmax=0,this._sizeStart=null,this._displayBounds=B(),this._displayBoundsStart=B(),this._displayBoundsMarginStart=0,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=y(),this._endScale=y()}initialize(){const{view:t,graphic:e,manipulators:i,_handles:s}=this,o=ot(t).colors,p=this._graphicState=new dt({graphic:e}),l=e.geometry;this._editGeometryOperations=ft.fromGeometry(l,t.state.viewingMode),this._graphicMoveManipulation=new pt({tool:this,view:t,graphicState:p}),this._moveZManipulator=I(t,{offsetMode:Z.CENTER_ON_CALLOUT,calloutColor:o.accent,color:o.contrast,outlineColor:o.accent}),this._moveZManipulator.state|=C,s.add([this._createMoveXYGraphicDragPipeline(),r((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._moveZManipulator,at.TRANSLATE_Z))),this._createMoveZDragPipeline()]),i.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map((e=>{const i=k(t,e,{color:o.accent});return s.add([r((()=>this.enableScaling),(()=>this._updateManipulatorAvailability(i,at.SCALE))),i.events.on("grab-changed",(t=>this._onResizeGrab(t))),this._createResizeDragPipeline(i,e)]),i})),i.addMany(this._resizeManipulators);const h=!this.view._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this._rotateManipulatorTexture=J(t.toolViewManager.textures,{accentColor:Pt(o.accent,.5),contrastColor:o.contrast,preMultiplyAlpha:h}),this._rotateManipulator=Q(t,{calloutColor:zt(o.accent),texture:this._rotateManipulatorTexture.texture}),s.add([r((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._rotateManipulator,at.ROTATE))),this._rotateManipulator.events.on("grab-changed",(t=>{this._onRotateGrab(t)})),this._createRotateDragPipeline(this._rotateManipulator)]),i.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const c=rt({view:t,graphic:e,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>a()});null!=c&&(this._outlineVisualElement=c.visualElement instanceof ht?c.visualElement:null),null!=this._outlineVisualElement&&s.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>this._updateDisplayBounds()))),s.add(c),s.add([p.on("changed",(()=>this._onGeometryChanged())),r((()=>p.displaying),(()=>this._updateAllManipulatorAvailability())),r((()=>p.isDraped),(()=>this._graphicDrapedChanged()),n),t.trackGraphicState(p)]);const u=t.pointsOfInterest;s.add(r((()=>u?.centerOnSurfaceFrequent.location),(()=>this._updateDisplayBounds())));const d=t=>{s.add(t.events.on("grab-changed",(()=>{this.grabbing=t.grabbing,this._updateAllManipulatorAvailability()})))};this._forEachManipulator(d);const m=(t,i)=>{s.add(t.events.on("immediate-click",(t=>{i===at.TRANSLATE_XY&&this.emit("immediate-click",{...t,graphic:e}),t.stopPropagation()})))};this._forEachManipulator(m),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{_handles:t,view:e}=this,i=this._tooltip=new Rt({view:e}),a=()=>{i.info=this._getUpdatedTooltipInfo()};t.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()})),this.on("graphic-rotate-start",(t=>{this._startAngle=t.angle,a()})),this.on("graphic-rotate",(t=>{this._endAngle=t.angle,a()})),this.on("graphic-rotate-stop",(()=>{this._startAngle=0,this._endAngle=0,a()})),this.on("graphic-scale-start",(t=>{m(this._startScale,t.xScale,t.yScale),m(this._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale",(t=>{m(this._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale-stop",(()=>{m(this._startScale,0,0),m(this._endScale,0,0),a()}))]),this._forEachManipulator((e=>{t.add([e.events.on("focus-changed",a),e.events.on("grab-changed",a),e.events.on("drag",(t=>{"cancel"===t.action?this._tooltip.clear():a()}))])}))}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some((t=>t.focused))?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo??=new Gt({tooltipOptions:this.tooltipOptions})}_computeMoveZTooltipInfo(){const t=this._moveZTooltipInfo??=new Dt({tooltipOptions:this.tooltipOptions}),e=this._moveUnit;if(this._moveZManipulator.dragging){const e=this._mapBoundsStart.origin,i=this._mapBounds.origin,a=Ut(e,i,this.view.spatialReference);if(null==a)return null;t.distance=a}else t.distance=o(0,e);return t}_computeRotateTooltipInfo(){const t=this._rotateTooltipInfo??=new Ot({tooltipOptions:this.tooltipOptions});return t.angle=this._startAngle-this._endAngle,t}_computeScaleTooltipInfo(){const t=this.graphic.geometry;if(null==t)return null;const e=this._scaleTooltipInfo??=new jt({tooltipOptions:this.tooltipOptions}),i=bt(this._mapBounds,this._zmax,t.spatialReference,this._graphicState.isDraped);return null==i?null:(e.xSize=i[0],e.ySize=i[1],null!=this._sizeStart&&this._resizeManipulators.some((t=>t.dragging))?(e.xScale=i[0].value/this._sizeStart[0].value,e.yScale=i[1].value/this._sizeStart[1].value):(e.xScale=1,e.yScale=1),e)}_graphicDrapedChanged(){this._handles.remove(Zt),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",(t=>{null!=this._attachmentOrigin&&A(t.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._updateDisplayBounds()})),Zt)}_updateAllManipulatorAvailability(){this._forEachManipulator(((t,e)=>this._updateManipulatorAvailability(t,e)))}_updateManipulatorAvailability(t,e){const i=this.grabbing&&!t.grabbing;if(t.interactive=!i,t instanceof K){const a=this._graphicState.displaying,s=this.enableZ&&st(this.graphic);switch(e){case at.ROTATE:t.available=a&&this.enableRotation;break;case at.SCALE:t.available=a&&(this.enableScaling||this.enableRotation||s),t.interactive=!i&&this.enableScaling,t.state=this.enableScaling?L:X;break;case at.TRANSLATE_Z:t.available=a&&s;break;default:t.available=a}}}_forEachManipulator(t){this._graphicMoveManipulation.forEachManipulator(t),this._resizeManipulators.forEach((e=>t(e,at.SCALE))),t(this._rotateManipulator,at.ROTATE),t(this._moveZManipulator,at.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(t){this._preserveAspectRatio.enabled=t,this._set("preserveAspectRatio",t)}get _moveUnit(){return l(this.view.spatialReference)??"meters"}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const t=this.graphic.geometry,e=this._editGeometryOperations.data,i=e.components[0].edges[0],a=_(w.get(),i.leftVertex.pos,i.rightVertex.pos);g(a,a);const s=$(this.view,this.graphic)??t.extent?.center;let o=s?kt*this.view.pixelSizeAt(s):0;const r=this.view.spatialReference,n=t.spatialReference;r.equals(n)||(o*=h(r)/h(n)),Tt(a,e,o,this._mapBounds),this._updateZMax()}_updateZMax(){const t=this._editGeometryOperations.data;if(!t.geometry.hasZ)return void(this._zmax=0);const e=t.coordinateHelper;let i=Number.NEGATIVE_INFINITY;for(const a of t.components)for(const t of a.vertices){const a=e.getZ(t.pos)??0;i=Math.max(a,i)}this._zmax=i}_updateDisplayBounds(){const{geometry:t}=this.graphic;if(null==t)return;const{extent:e}=t;if(!e)return;const i=null==this._outlineVisualElement||this._graphicState.isDraped||null==this._outlineVisualElement.attachmentOrigin?$(this.view,this.graphic):this._outlineVisualElement.attachmentOrigin;this._attachmentOrigin=i??e.center;const a=null!=i?i.z:ct(this._mapBounds.origin,this.view.elevationProvider,ut.fromElevationInfo(U(this.graphic)),this.view.renderCoordsHelper),s=O(this._mapBounds);s.origin[2]=a??0,xt(s,this.view.renderCoordsHelper,t.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators()}get _displayBoundsMargin(){const t=this.view.pointsOfInterest,e=t?t.centerOnSurfaceFrequent.location:this._editGeometryOperations.data.geometry.extent?.center;return e?Ct*this.view.pixelSizeAt(e):0}_createMoveXYGraphicDragPipeline(){return this._graphicMoveManipulation.createDragPipeline(((t,e,i)=>this._applyGraphicMoveSteps(e,i,nt.XY)))}_createMoveZDragPipeline(){const t=this.view,e=this._editGeometryOperations.data.spatialReference;return _t(this._moveZManipulator,((i,a,s)=>{const o=E(i.renderLocation),r=a.next(et(t,o,e)).next(yt());this._applyGraphicMoveSteps(r,s,nt.Z)}))}_applyGraphicMoveSteps(t,e,i){const a=t.next((t=>("start"===t.action&&(this.inputState={type:"move"},this._updateOperationStartProperties(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY})),t))).next(gt()).next(this._moveDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY};switch(t.action){case"start":case"update":(t.mapEnd.x-t.mapStart.x||t.mapEnd.y-t.mapStart.y||(t.mapEnd.z??0)-(t.mapStart.z??0))&&this.emit("graphic-translate",e);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",e)}return t})).next((t=>this._updateMoveTooltip(t,i)));return e.next((()=>{null!=this.inputState&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()})),a}_updateOperationStartProperties(){O(this._displayBounds,this._displayBoundsStart),O(this._mapBounds,this._mapBoundsStart),null!=this.graphic.geometry?this._sizeStart=bt(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped):this._sizeStart=null}_moveDragUpdateGeometry(){return t=>{if(null==this.inputState||"move"!==this.inputState.type)return t;const e=[];for(const s of this._editGeometryOperations.data.components)e.push(...s.vertices);const i="start"===t.action?St.NEW_STEP:St.ACCUMULATE_STEPS,a=this._editGeometryOperations.moveVertices(e,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i);return Et(a,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_updateMoveTooltip(t,e){if(e===nt.XY||e===nt.XY_AXIS){const e=wt(t.mapStart,t.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");null!=e&&null!=this._moveXYTooltipInfo&&(this._moveXYTooltipInfo.distance=e)}return t}_onResizeGrab({action:t,screenPoint:e}){if("start"!==t||!e)return;const i=this._calculatePickRay(e);j(this._displayBounds.plane,i,P.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(t,e){return _t(t,((t,i,a)=>{null!=this.inputState&&(i.next((t=>("start"===t.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),t))).next(it(this.view,this._displayBoundsStart.plane)).next((t=>({...t,handle:e}))).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatio.createDragEventPipelineStep()).next(this._resizeDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,xScale:t.factor1,yScale:t.factor2};switch(t.action){case"start":case"update":this.emit("graphic-scale",e);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",e)}return t})),a.next((()=>{null!=this.inputState&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()})))}))}_resizeDragRenderPlaneToFactors(){return t=>{const e=this._displayBoundsStart,i=t.handle.direction,a=this._displayBoundsMargin,s=this._displayBoundsMarginStart,o=v(P.get(),e.origin);f(o,o,e.basis1,-i[0]),f(o,o,e.basis2,-i[1]);const r=S(P.get(),t.renderEnd,o),n=S(P.get(),t.renderStart,o),p=Y(t.handle),l=N(e),h=N(this._displayBounds)/l,c=(t,e)=>{if(0===t)return 1;let i=b(e),o=.5*t*T(e,r)/i;const l=o<0?-1:1;if(p){o+=(i-.5*t*T(e,n)/i)*l*h}const c=i<1.5*s?1:Lt;return i=Math.max(i-s,Lt),l>0&&(o-=a),l*Math.max(l*(o/i),c)};return{...t,factor1:c(i[0],e.basis1),factor2:c(i[1],e.basis2)}}}_resizeDragUpdateGeometry(){return t=>{const e=v(x(),this._mapBoundsStart.origin);f(e,e,this._mapBoundsStart.basis1,-t.handle.direction[0]),f(e,e,this._mapBoundsStart.basis2,-t.handle.direction[1]);const i=m(y(),this._mapBoundsStart.basis1[0],this._mapBoundsStart.basis1[1]);g(i,i);const a=[];for(const r of this._editGeometryOperations.data.components)a.push(...r.vertices);const s="start"===t.action?St.NEW_STEP:St.ACCUMULATE_STEPS,o=this._editGeometryOperations.scaleVertices(a,e,i,t.factor1,t.factor2,s,Mt.REPLACE);return O(this._mapBoundsStart,this._mapBounds),Et(o,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_onRotateGrab({action:t,screenPoint:e}){if("start"!==t||!e)return;const i=V(this._displayBounds,this.view.renderCoordsHelper,H.HEADING,R()),a=this._calculatePickRay(e);j(i,a,P.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:i})}_createRotateDragPipeline(t){return _t(t,((t,e,i)=>{const a=this.inputState;null!=a&&(e.next((t=>("start"===t.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),t))).next(it(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,angle:s(t.rotateAngle)};switch(t.action){case"start":case"update":this.emit("graphic-rotate",e);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",e)}return t})),i.next((()=>{null!=this.inputState&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()})))}))}_rotateDragRenderPlaneToRotate(t){return e=>{const i=G(t.rotatePlane),a=tt(e.renderStart,e.renderEnd,this._displayBounds.origin,i);return{...e,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdateGeometry(){return t=>{const e=v(x(),this._mapBoundsStart.origin),i=[];for(const o of this._editGeometryOperations.data.components)i.push(...o.vertices);const a="start"===t.action?St.NEW_STEP:St.ACCUMULATE_STEPS,s=this._editGeometryOperations.rotateVertices(i,e,t.rotateAngle,a,Mt.REPLACE);return O(this._mapBoundsStart,this._mapBounds),Et(s,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_calculatePickRay(t){const e=D(),i=p(t);return mt(this.view.state.camera,i,e),M(e.direction,e.direction),e}_updateManipulators(){if(!this.visible)return;const t=F(this._displayBounds,z.get());q(this._rotateManipulator,t,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,t),this._resizeManipulators.forEach(((e,i)=>{W(e,this._resizeHandles[i],t,this._displayBounds)}))}_updateZMoveHandle(t,e){const i=this._displayBounds,a={basis:i.basis1,direction:-1,position:S(P.get(),i.origin,i.basis1),edge:2},s=z.get();d(s,e,a.edge*Math.PI/2),s[12]=0,s[13]=0,s[14]=0,t.modelTransform=s,t.renderLocation=a.position}_cancel(){const t=this._editGeometryOperations.lastOperation;null!=t&&(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,At(t,this._mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if(null!=this.inputState)this.view.activeTool=null;else if(this.canUndo){const t=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,At(t,this._mapBounds),this._updateDisplayBounds()}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const t=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,Et(t,this._mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}};t([c({constructOnly:!0,nonNullable:!0})],It.prototype,"view",void 0),t([c({constructOnly:!0,nonNullable:!0})],It.prototype,"graphic",void 0),t([c({constructOnly:!0,nonNullable:!0})],It.prototype,"enableZ",void 0),t([c()],It.prototype,"enableRotation",void 0),t([c()],It.prototype,"enableScaling",void 0),t([c({constructOnly:!0,type:Bt})],It.prototype,"tooltipOptions",void 0),t([c()],It.prototype,"preserveAspectRatio",null),t([c()],It.prototype,"grabbing",void 0),t([c()],It.prototype,"inputState",void 0),t([c({readOnly:!0})],It.prototype,"type",void 0),t([c()],It.prototype,"_moveUnit",null),It=t([u("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],It);const Zt="draped-elevation-changes",Ct=10,kt=80,Lt=1e-6;export{Lt as EPSILON,It as ExtentTransformTool};
