/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{c as e,d as t}from"../../../chunks/mat3.js";import{c as n}from"../../../chunks/mat3f64.js";import{a,c as r}from"../../../chunks/quat.js";import{a as s,b as i}from"../../../chunks/quatf32.js";import{a as f}from"../../../chunks/quatf64.js";import{c as o,q as c,x as h,y as u,z as l,b as z,w as S,s as m,t as b,a as M,u as q,l as p,g as j,A as k,B as g,C as x}from"../../../chunks/vec3.js";import{a as y,b as v}from"../../../chunks/vec3f32.js";import{b as w,a as d,c as A}from"../../../chunks/vec3f64.js";import{t as B}from"../../../chunks/vec4.js";import{c as C}from"../../../chunks/vec4f64.js";import{create as G}from"../../../geometry/support/aaBoundingBox.js";import{signedDistance as I,normal as V}from"../../../geometry/support/plane.js";import{ViewingMode as D}from"../../ViewingMode.js";import{computeOBB as E}from"./dito.js";const F=f(),H=A(),J=A(),K=C(),L=n();class N{constructor(e){const t=56,n=0,a=24,r=36,i=e*t;this.buffer=new ArrayBuffer(i),this.obbs=new Array(e);for(let f=0;f<e;f++)this.obbs[f]={center:w(this.buffer,t*f+n),halfSize:y(this.buffer,t*f+a),quaternion:s(this.buffer,t*f+r)}}}function O(e=[0,0,0],t=[-1,-1,-1],n=f()){return{center:d(e),halfSize:v(t),quaternion:i(n)}}function P(e){return O(e.center,e.halfSize,e.quaternion)}function Q(e,t){o(t.center,e.center),o(t.halfSize,e.halfSize),a(t.quaternion,e.quaternion)}function R(e,t){return t=t||O(),E(e,t),t}function T(e,t){const n=I(t,e.center),a=ne(e,V(t));return n>a?1:n<-a?-1:0}function U(e,t){return H[0]=e.center[0]-t[0],H[1]=e.center[1]-t[1],H[2]=e.center[2]-t[2],r(F,e.quaternion),c(H,H,F),h(H,H),u(J,H,e.halfSize),l(J,H)<t[3]*t[3]}function W(t,n){n||(n=G());const a=e(L,t.quaternion),r=t.halfSize[0]*Math.abs(a[0])+t.halfSize[1]*Math.abs(a[3])+t.halfSize[2]*Math.abs(a[6]),s=t.halfSize[0]*Math.abs(a[1])+t.halfSize[1]*Math.abs(a[4])+t.halfSize[2]*Math.abs(a[7]),i=t.halfSize[0]*Math.abs(a[2])+t.halfSize[1]*Math.abs(a[5])+t.halfSize[2]*Math.abs(a[8]);return n[0]=t.center[0]-r,n[1]=t.center[1]-s,n[2]=t.center[2]-i,n[3]=t.center[0]+r,n[4]=t.center[1]+s,n[5]=t.center[2]+i,n}function X(e,t){return I(t,e.center)-ne(e,V(t))}function Y(e,t){return I(t,e.center)+ne(e,V(t))}function Z(e,t){return T(e,t[0])<=0&&T(e,t[1])<=0&&T(e,t[2])<=0&&T(e,t[3])<=0&&T(e,t[4])<=0&&T(e,t[5])<=0}function $(e,t,n,a=0){r(F,e.quaternion),z(H,t,e.center);const s=c(H,H,F),i=c(J,n,F);let f=-1/0,o=1/0;for(let r=0;r<3;r++)if(Math.abs(i[r])>1e-6){const t=(a+e.halfSize[r]-s[r])/i[r],n=(-a-e.halfSize[r]-s[r])/i[r];f=Math.max(f,Math.min(t,n)),o=Math.min(o,Math.max(t,n))}else if(s[r]>e.halfSize[r]+a||s[r]<-e.halfSize[r]-a)return!1;return f<=o}function _(n,a,s,i,f){r(F,n.quaternion),S(H,a,n.center),c(H,H,F);const o=H[0]<-n.halfSize[0]?-1:H[0]>n.halfSize[0]?1:0,h=H[1]<-n.halfSize[1]?-1:H[1]>n.halfSize[1]?1:0,u=H[2]<-n.halfSize[2]?-1:H[2]>n.halfSize[2]?1:0,l=Math.abs(o)+Math.abs(h)+Math.abs(u);if(0===l)return 1/0;const z=1===l?4:6,q=6*(o+3*h+9*u+13);e(L,n.quaternion),t(L,L,n.halfSize);for(let e=0;e<z;e++){const t=te[q+e];m(H,((1&t)<<1)-1,(2&t)-1,((4&t)>>1)-1),b(H,H,L),M(K,n.center,H),K[3]=1,B(K,K,s);const a=1/Math.max(1e-6,K[3]);ee[2*e]=K[0]*a,ee[2*e+1]=K[1]*a}const p=2*z-2;let j=ee[0]*(ee[3]-ee[p+1])+ee[p]*(ee[1]-ee[p-1]);for(let e=2;e<p;e+=2)j+=ee[e]*(ee[e+3]-ee[e-1]);return Math.abs(j)*i*f*.125}const ee=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],te=(()=>{const e=new Int8Array(162);let t=0;const n=n=>{for(let a=0;a<n.length;a++)e[t+a]=n[a];t+=6};return n([6,2,3,1,5,4]),n([0,2,3,1,5,4]),n([0,2,3,7,5,4]),n([0,1,3,2,6,4]),n([0,1,3,2,0,0]),n([0,1,5,7,3,2]),n([0,1,3,7,6,4]),n([0,1,3,7,6,2]),n([0,1,5,7,6,2]),n([0,1,5,4,6,2]),n([0,1,5,4,0,0]),n([0,1,3,7,5,4]),n([0,2,6,4,0,0]),n([0,0,0,0,0,0]),n([1,3,7,5,0,0]),n([2,3,7,6,4,0]),n([2,3,7,6,0,0]),n([2,3,1,5,7,6]),n([0,1,5,7,6,2]),n([0,1,5,7,6,4]),n([0,1,3,7,6,4]),n([4,5,7,6,2,0]),n([4,5,7,6,0,0]),n([4,5,1,3,7,6]),n([0,2,3,7,5,4]),n([6,2,3,7,5,4]),n([6,2,3,1,5,4]),e})();function ne(e,t){r(F,e.quaternion),c(H,t,F);const n=e.halfSize;return Math.abs(H[0]*n[0])+Math.abs(H[1]*n[1])+Math.abs(H[2]*n[2])}function ae(e,t){for(let n=0;n<8;++n){const a=t[n];a[0]=1&n?-e.halfSize[0]:e.halfSize[0],a[1]=2&n?-e.halfSize[1]:e.halfSize[1],a[2]=4&n?-e.halfSize[2]:e.halfSize[2],c(a,a,e.quaternion),M(a,a,e.center)}}function re(e){return q(e.halfSize)}function se(e,t,n,s,i){if(a(i.quaternion,e.quaternion),s===D.Global){r(ce,e.quaternion),c(ie,e.center,ce),h(fe,ie),u(oe,fe,e.halfSize),S(oe,fe,oe);const a=p(oe);M(oe,fe,e.halfSize);const s=p(oe);if(a<n)o(i.center,e.center),m(ie,n,n,n),M(i.halfSize,e.halfSize,ie);else{const r=s>0?1+t/s:1,f=a>0?1+n/a:1,o=(f+r)/2,h=(f-r)/2;j(i.halfSize,fe,h),k(i.halfSize,i.halfSize,e.halfSize,o),j(i.center,fe,o),k(i.center,i.center,e.halfSize,h),g(ie,ie),x(i.center,i.center,ie),c(i.center,i.center,i.quaternion)}}else{const a=m(ie,0,0,1);k(i.center,e.center,a,(n+t)/2),r(ce,e.quaternion),c(a,a,ce),h(a,a),k(i.halfSize,e.halfSize,a,(n-t)/2)}return i}const ie=A(),fe=A(),oe=A(),ce=f();export{N as ObbArray,P as clone,R as compute,se as computeOffsetObb,ae as corners,O as create,$ as intersectLine,T as intersectPlane,U as intersectSphere,Z as isVisible,Y as maximumDistancePlane,X as minimumDistancePlane,_ as projectedArea,ne as projectedRadius,re as radius,Q as set,W as toAaBoundingBox};
