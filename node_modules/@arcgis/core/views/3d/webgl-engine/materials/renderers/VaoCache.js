/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{RemoveMode as t,MIN_PRIORITY as e}from"../../../../../core/MemCache.js";import{VertexArrayObject as o}from"../../lib/VertexArrayObject.js";import{BufferObject as r}from"../../../../webgl/BufferObject.js";import{Usage as s}from"../../../../webgl/enums.js";const c=e+1;class i{constructor(t,e,o){this._rctx=t,this._locations=e,this._layout=o,this._cache=t.newCache("VaoCache",n)}dispose(){this._cache.destroy()}newVao(t){const e=t.toString(),i=this._cache.pop(e);if(null!=i){const o=i.pop();return i.length>0&&this._cache.put(e,i,t*i.length,c),o}const n=new o(this._rctx,this._locations,{geometry:this._layout},{geometry:r.createVertex(this._rctx,s.STATIC_DRAW)});return n.vertexBuffers.geometry.setSize(t),n}deleteVao(t){if(null==t)return null;const e=t.byteSize,o=e.toString(),r=this._cache.pop(o);return null!=r?(r.push(t),this._cache.put(o,r,e*r.length,-1)):this._cache.put(o,[t],e,-1),null}}function n(e,o){if(o===t.ALL)return void e.forEach((t=>t.dispose()));const r=e.pop(),s=e.length*r.byteSize;return r.dispose(),s}export{i as VaoCache};
