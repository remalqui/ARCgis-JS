/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{c as t}from"../../../../chunks/mat4f64.js";import{s as o}from"../../../../chunks/vec2.js";import{a as s}from"../../../../chunks/vec2f64.js";import{s as n,e as r,b as e,g as m,a,c,A as i,n as f,f as I}from"../../../../chunks/vec3.js";import{c as l}from"../../../../chunks/vec3f64.js";import{getReferenceEllipsoid as h}from"../../../../geometry/ellipsoidUtils.js";import{lonLatToWebMercatorComparable as u}from"../../../../geometry/projection.js";import{newDoubleArray as N}from"../../../../geometry/support/DoubleArray.js";import{create as p,fromManyPointsSampleAt as g,normal as b}from"../../../../geometry/support/plane.js";import{ViewingMode as M}from"../../../ViewingMode.js";function T(t,s,n,r,e=1){if(n.isGeographic&&r===M.Global){const t=N(s.length),o=s.length,r=h(n);for(let n=0;n<o;n+=3)u(s,n,t,n,r);s=t}o(y,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let o=0;o<s.length;o+=3)y[0]=Math.min(y[0],s[o]),y[1]=Math.min(y[1],s[o+1]);const m=y[0]%e,a=y[1]%e,c=y[0]-m,i=y[1]-a;for(let o=0;o<s.length;o+=3){const n=o/3*4;t[n]=(s[o]-c)/e,t[n+1]=(s[o+1]-i)/e,t[n+2]=c/e,t[n+3]=i/e}}function j(t,s,c,i,f=1){n(Y,1,0,0),n(_,0,1,0),n(k,0,0,1),U(E,c),G(c,F)&&O(F,Y,_,k,i,E),o(y,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o(A,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let o=0;o<c.length;o+=3){n(V,c[o],c[o+1],c[o+2]);const t=r(Y,V),s=r(_,V);y[0]=Math.min(y[0],t),y[1]=Math.min(y[1],s),A[0]=Math.max(A[0],t),A[1]=Math.max(A[1],s)}const I=r(k,E);z(P,y[0],y[1],I,Y,_,k),z(v,A[0],y[1],I,Y,_,k),z(x,y[0],A[1],I,Y,_,k),e(v,v,P),m(v,v,.5),e(x,x,P),m(x,x,.5),a(P,P,v),a(P,P,x);const l=y[0]%f,h=y[1]%f,u=y[0]-l,N=y[1]-h;for(let o=0;o<c.length;o+=3){n(V,c[o],c[o+1],c[o+2]);const e=o/3,m=4*e;t[m]=(r(Y,V)-u)/f,t[m+1]=(r(_,V)-N)/f,t[m+2]=u/f,t[m+3]=N/f;const a=9*e;for(let t=0;t<3;t++)s[a+t]=P[t],s[a+t+3]=v[t],s[a+t+6]=x[t]}}const E=l(),V=l(),F=p(),Y=l(),_=l(),k=l(),y=s(),A=s(),P=l(),v=l(),x=l();function G(t,o){const s=t.length/3-1;return g(t,o,0,Math.floor(s/3),Math.floor(s*(2/3)))}function O(t,o,s,e,a,l){null!=a?(a.basisMatrixAtPosition(l,S),n(d,S[0],S[1],S[2]),n(w,S[4],S[5],S[6]),n(D,S[8],S[9],S[10])):(n(d,1,0,0),n(w,0,1,0),n(D,0,0,1));const h=b(t);r(h,D)<0&&m(h,h,-1),c(e,h);const u=r(h,w),N=r(h,d);Math.abs(u)<Math.abs(N)?(i(o,d,h,-N),f(o,o),I(s,o,h),f(s,s),m(s,s,-1)):(i(s,w,h,-u),f(s,s),I(o,s,h),f(o,o))}const S=t(),d=l(),w=l(),D=l();function U(t,o){n(q,0,0,0);for(let s=0;s<o.length-3;s+=3)q[0]+=o[s],q[1]+=o[s+1],q[2]+=o[s+2];m(t,q,1/(o.length/3-1))}const q=l();function z(t,o,s,r,e,m,a){n(t,o*e[0]+s*m[0]+r*a[0],o*e[1]+s*m[1]+r*a[1],o*e[2]+s*m[2]+r*a[2])}export{j as createMapSpaceUVCoords,T as createMapSpaceUVCoordsDraped};
