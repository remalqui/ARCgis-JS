/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{a as t}from"../../../chunks/vec3.js";import{empty as e}from"../../../geometry/support/aaBoundingBox.js";import{BufferPool as s}from"../../../geometry/support/buffer/BufferPool.js";import{newLayout as i}from"../support/buffer/InterleavedLayout.js";import{internalAssert as r}from"./terrainUtils.js";import{decompressNormal as n,compressNormal as o}from"../webgl-engine/lib/Normals.js";import{VertexAttribute as u}from"../webgl-engine/lib/VertexAttribute.js";class l{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=e(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class a{constructor(t,e,s,i,r){this.attributes=t,this.localOrigin=e,this.index0=s,this.stride=i,this.count=r}getVertexIndex(t){return this.getAttributeIndex(t)}getAttributeIndex(t){return r(0<=t&&t<this.count),this.index0+this.stride*t}_getVertexRaw(t,e){this.attributes.position.getVec(t,e)}getVertexPos(e,s){this._getVertexRaw(this.getAttributeIndex(s),e),t(e,e,this.localOrigin)}getNormal(t,e){const{typedBuffer:s,typedBufferStride:i}=this.attributes.normalCompressed;n(t,s,this.getAttributeIndex(e),i)}_setNormal(t,e,s,i){const{typedBuffer:r,typedBufferStride:n}=this.attributes.normalCompressed;o(r,t,e,s,i,n)}_setUV(t,e,s){b(this.attributes.uv0,t,e,s)}setNormalFromValues(t,e,s,i){this._setNormal(this.getAttributeIndex(t),e,s,i)}setVertexFromValuesRawPositionUV(t,e,s,i,r,n){const o=this.getAttributeIndex(t);this.attributes.position.setValues(o,e,s,i),this._setUV(o,r,n)}setVertexFromValuesRawPositionUVNormal(t,e,s,i,r,n,o,u,l){const a=this.getAttributeIndex(t);this.attributes.position.setValues(a,e,s,i),this._setUV(a,r,n),this._setNormal(a,o,u,l)}}const h=i().vec3f(u.POSITION).vec2i16(u.UV0).vec2i16(u.NORMALCOMPRESSED,{glNormalized:!0}),c=new s((t=>h.createBuffer(t)),(t=>t.count));function m(){c.clear()}function d(t){return c.acquire(t)}function f(t){c.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}const g=16384;function b(t,e,s,i){t.setValues(e,s*g,i*g)}function x(t,e,s,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),s<i[2]?i[2]=s:s>i[5]&&(i[5]=s)}export{a as EdgeDescriptor,l as PatchGeometry,d as acquireTerrainAttributes,m as clearCaches,b as encodeUVInBuffer,x as minMaxBoundingBox,f as releaseGeometry};
