/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import has from"../../../core/has.js";import{Milliseconds as e}from"../../../core/time.js";import{RenderTargetType as r}from"./interfaces.js";import{OverlayFramebufferObject as t}from"./OverlayFramebufferObject.js";import{ShaderOutput as o}from"../webgl-engine/core/shaderLibrary/ShaderOutput.js";class s{constructor(r,o,s,a=!0){this.output=o,this.type=s,this.valid=!1,this.lastUsed=e(1/0),this.fbo=new t(r,a)}}class a{constructor(e){this.renderTargets=[new s(e,o.Color,r.Color),new s(e,o.Color,r.ColorNoRasterImage),new s(e,o.Highlight,r.Highlight,!1),new s(e,o.Normal,r.Water),new s(e,o.Color,r.Occluded)],has("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new s(e,o.ObjectAndLayerIdColor,r.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(r,t,o){return r?(t.lastUsed=o,!1):o-t.lastUsed>d?(t.fbo.disposeRenderTargetMemory(),t.lastUsed=e(1/0),!1):t.lastUsed<1/0}get gpuMemoryUsage(){return this.renderTargets.reduce(((e,r)=>e+r.fbo.gpuMemoryUsage),0)}}const d=e(1e3);export{a as OverlayRenderTarget,s as RenderTargetDescriptor};
