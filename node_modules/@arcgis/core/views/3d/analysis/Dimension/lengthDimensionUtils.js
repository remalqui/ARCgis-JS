/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{LengthDimensionMeasureType as e}from"../../../../analysis/dimensionUtils.js";import{deg2rad as n}from"../../../../core/mathUtils.js";import{toUnit as t}from"../../../../core/quantityUtils.js";import{preferredVerticalLengthUnit as r,preferredLengthUnit as i}from"../../../../core/unitUtils.js";import{d as o}from"../../../../chunks/mat4.js";import{c as a}from"../../../../chunks/mat4f64.js";import{c as s,A as d,w as c,F as l,e as u,z as p,m,f as S,n as f,p as g}from"../../../../chunks/vec3.js";import{c as v,Z as R}from"../../../../chunks/vec3f64.js";import{Axis as A}from"../../../../geometry/support/Axis.js";import{sv3d as P}from"../../../../geometry/support/vectorStacks.js";import{makeDehydratedPoint as y}from"../../../../layers/graphics/dehydratedFeatures.js";import{clonePoint as E}from"../../../../layers/graphics/hydratedFeatures.js";import{EuclideanSegment as h}from"../../interactive/visualElements/support/Segment.js";import{euclideanDirectDistance as j,euclideanDirectDistanceBetweenPoints as x}from"../../../support/euclideanLengthMeasurementUtils.js";function T(n,o,a){if(null==n)return null;const s=n.dimensionSegment.startRenderSpace,d=n.dimensionSegment.endRenderSpace,c=j(s,d,n.spatialReference);if(null==c)return null;const l=o===e.Vertical?r(c.value,c.unit,a):i(c.value,c.unit,a);return t(c,l)}function w(e){const{elevationAlignedStartPoint:n,elevationAlignedEndPoint:t,dimension:{offset:r,measureType:i,orientation:o}}=e;return{elevationAlignedStartPoint:n,elevationAlignedEndPoint:t,offset:r,measureType:i,orientation:o}}function C({elevationAlignedStartPoint:n,elevationAlignedEndPoint:t,offset:r,measureType:i,orientation:o},a,d=null){if(null==n||null==t)return null;const c=b(null!=d?d.directSegment:new h,{elevationAlignedStartPoint:n,elevationAlignedEndPoint:t},a),l=null!=d?d.primaryOffsetAxis:v();I(l,{measureType:i,elevationAlignedStartPoint:n,elevationAlignedEndPoint:t,directSegment:c,orientation:o,renderCoordsHelper:a});const u=null!=d?d.dimensionSegment:new h;return B({elevationAlignedStartPoint:n,elevationAlignedEndPoint:t})&&i===e.Vertical?(s(u.startRenderSpace,c.startRenderSpace),s(u.endRenderSpace,c.endRenderSpace)):L(u,{offsetAxis:l,offset:r,relativeToSegment:c,renderCoordsHelper:a}),{directSegment:c,dimensionSegment:u,primaryOffsetAxis:l,spatialReference:a.spatialReference}}function H(e,n,t,r){return n===z.Start?(s(e.startRenderSpace,t.startRenderSpace),s(e.endRenderSpace,r.startRenderSpace)):(s(e.startRenderSpace,t.endRenderSpace),s(e.endRenderSpace,r.endRenderSpace)),e}var z;function k(e,n,t,r){d(e.startRenderSpace,n.startRenderSpace,t,r),d(e.endRenderSpace,n.endRenderSpace,t,r)}function U(n,t,r,i){switch(t){case e.Direct:return b(n,r,i);case e.Horizontal:case e.Vertical:{const{elevationAlignedStartPoint:o,elevationAlignedEndPoint:a,dimension:s,geometry:d}=r;let c;if(s.measureType===e.Direct){c=M(d,i)===o.z>a.z,t===e.Horizontal&&(c=!c)}else c=!V(d);const[l,u]=c?[o,a]:[a,o],p=E(u,D);return t===e.Horizontal?p.z=l.z:(p.x=l.x,p.y=l.y),i.toRenderCoords(l,n.startRenderSpace),i.toRenderCoords(p,n.endRenderSpace),n}}}function b(e,n,t){return t.toRenderCoords(n.elevationAlignedStartPoint,e.startRenderSpace),t.toRenderCoords(n.elevationAlignedEndPoint,e.endRenderSpace),e}function M(e,n){const t=e.directSegment.eval(.5,P.get()),r=n.worldUpAtPosition(t,P.get()),i=e.dimensionSegment.eval(.5,P.get()),o=c(P.get(),i,t);return!l(o,R)&&u(o,r)>0}function V(e){const{startRenderSpace:n,endRenderSpace:t}=e.dimensionSegment,{startRenderSpace:r,endRenderSpace:i}=e.directSegment;return p(r,n)<p(i,t)}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(z||(z={}));const D=y(0,0,0,null);function F(e,n,t,r){const{directSegment:i}=t,o=I(P.get(),{measureType:n,directSegment:i,renderCoordsHelper:r}),a=L(O,{offsetAxis:o,offset:0,relativeToSegment:i,renderCoordsHelper:r}).eval(.5,P.get()),s=c(P.get(),e,a);return u(s,o)*r.unitInMeters}const O=new h;function I(t,r){const{measureType:i,elevationAlignedStartPoint:a,elevationAlignedEndPoint:d,directSegment:{startRenderSpace:p,endRenderSpace:g},directSegment:v,renderCoordsHelper:y}=r,E=v.eval(.5,P.get()),h=y.worldUpAtPosition(E,P.get()),j=y.worldBasisAtPosition(E,A.Y,P.get());switch(i){case e.Horizontal:s(t,h);break;case e.Vertical:u(p,h)<u(g,h)?c(t,g,p):c(t,p,g),S(t,t,h),S(t,t,h);break;case e.Direct:{const e=r.orientation??0;if(B({elevationAlignedStartPoint:a,elevationAlignedEndPoint:d}))o(q,-n(e),h),m(t,j,q);else{const r=c(P.get(),g,p),i=S(P.get(),r,h);S(i,i,r),o(q,n(e),r),m(t,i,q)}break}}return l(t,R)?s(t,j):f(t,t)}const q=a();function B({elevationAlignedStartPoint:e,elevationAlignedEndPoint:n}){return null!=e&&null!=n&&e.x===n.x&&e.y===n.y}function L(e,n){const{offsetAxis:t,offset:r,relativeToSegment:{startRenderSpace:i,endRenderSpace:o},relativeToSegment:a,renderCoordsHelper:s}=n,c=r/s.unitInMeters,[l,u]=Y(i,o,t,c);return d(e.startRenderSpace,a.startRenderSpace,t,l),d(e.endRenderSpace,a.endRenderSpace,t,u),e}function Y(e,n,t,r=0){const i=u(n,t),o=u(e,t),a=Math.abs(i-o)+r;return i>o?[a,r]:[r,a]}function Z(e,n,t){const r=n.directSegment.eval(.5,P.get());return t.worldUpAtPosition(r,e)}function G(e,n){const{startRenderSpace:t,endRenderSpace:r}=n.directSegment;return c(e,r,t)}function J(e,n,t={invert:!1}){const{startRenderSpace:r,endRenderSpace:i}=n.dimensionSegment;return t.invert?c(e,r,i):c(e,i,r)}function K(e,n){const t=e.directSegment.eval(.5,P.get());return n.headingAtPosition(t,e.primaryOffsetAxis)}function N(e,n){return g(J(Q,e))/n**2}const Q=v();function W(e){const{elevationAlignedStartPoint:n,elevationAlignedEndPoint:r}=e;if(null==n||null==r)return!1;const i=x(n,r);return null!=i&&t(i,"meters").value>X}const X=1e5;function $(e){return null!=e.geometry}export{X as GEODESIC_DISTANCE_THRESHOLD,z as OffsetSegmentLocation,B as arePointsVerticallyAligned,w as computationToGeometryDependencies,C as computeGeometryFromDimension,T as computeLength,I as computeOffsetAxis,F as computeOffsetForPoint,U as computeSegmentForMeasureType,H as computeSpanningSegment,J as dimensionStartToEnd,G as directStartToEnd,Z as directUp,K as headingFromGeometry,W as isGeodesicDimension,$ as isValidComputation,N as maxScreenLengthSquaredFromGeometry,k as offsetSegment};
