/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as i}from"../../../../chunks/tslib.es6.js";import t from"../../../../Color.js";import e from"../../../../core/Accessor.js";import s from"../../../../core/Handles.js";import{destroyMaybe as o}from"../../../../core/maybe.js";import{watch as r,syncAndInitial as l}from"../../../../core/reactiveUtils.js";import{property as a}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/accessorSupport/ensureType.js";import"../../../../core/arrayUtils.js";import"../../../../core/has.js";import{subclass as n}from"../../../../core/accessorSupport/decorators/subclass.js";import{E as m,m as p}from"../../../../chunks/mat4.js";import{s as u,l as h}from"../../../../chunks/vec3.js";import{Z as c}from"../../../../chunks/vec4f64.js";import{sv3d as d,sm4d as v}from"../../../../geometry/support/vectorStacks.js";import{settings as _}from"./settings.js";import{PLANE_PREVIEW_OUTLINE_WIDTH as w,PLANE_OUTLINE_WIDTH as V}from"./sliceToolConfig.js";import{createGridVisualElement as f,createOutlineVisualElement as E,calculateBoundedPlaneTranslateRotate as g}from"./sliceToolUtils.js";import{createStipplePatternSimple as j}from"../../webgl-engine/materials/lineStippleUtils.js";let y=class extends e{constructor(i){super(i),this._handles=new s,this._gridVisualElement=null,this._outlineVisualElement=null,this.showGrid=!1,this.preview=!0}initialize(){const i=this.analysisViewData;if(null==i)throw new Error("expected internal object to be valid");this._gridVisualElement=f(this.view),this._outlineVisualElement=E(this.view),this._handles.add([r((()=>({visible:null!=i.plane&&this.analysisViewData.visible,active:this.analysisViewData.active,preview:this.preview,showGrid:this.showGrid})),(i=>this._updateMaterials(i)),l),r((()=>i.plane),(i=>this._updatePlane(i)),l)],"internal")}destroy(){this._handles.destroy(),this._gridVisualElement=o(this._gridVisualElement),this._outlineVisualElement=o(this._outlineVisualElement),this.set("view",null)}_updatePlane(i){if(null==i)return;this._gridVisualElement.attached=!0,this._outlineVisualElement.attached=!0;const t=u(d.get(),h(i.basis1),h(i.basis2),1),e=m(v.get(),t),s=g(i,v.get()),o=p(e,s,e);this._outlineVisualElement.transform=o,this._gridVisualElement.transform=o}_updateMaterials({visible:i,active:e,preview:s,showGrid:o}){this._outlineVisualElement.color=t.toUnitRGBA(_.plane.outlineColor),this._outlineVisualElement.width=s?w:V,this._outlineVisualElement.stipplePattern=e?null:j(5),this._gridVisualElement.backgroundColor=t.toUnitRGBA(_.plane.color),this._gridVisualElement.gridColor=o?t.toUnitRGBA(_.plane.gridColor):c,this._gridVisualElement.visible=i,this._outlineVisualElement.visible=i}};i([a()],y.prototype,"view",void 0),i([a()],y.prototype,"analysis",void 0),i([a()],y.prototype,"analysisViewData",void 0),i([a()],y.prototype,"showGrid",void 0),i([a()],y.prototype,"preview",void 0),y=i([n("esri.views.3d.analysis.Slice.SliceVisualization")],y);export{y as SliceVisualization};
