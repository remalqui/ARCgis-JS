/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import r from"./aspectProcessor.js";import e from"./bandArithmeticProcessor.js";import o from"./compositeBandProcessor.js";import t from"./convolutionProcessor.js";import s from"./curvatureProcessor.js";import n from"./extractBandProcessor.js";import c from"./localProcessor.js";import i from"./maskProcessor.js";import m from"./ndviProcessor.js";import a from"./remapProcessor.js";import p from"./reprojectProcessor.js";import u from"./slopeProcessor.js";import f from"./stretchProcessor.js";import{ContextType as l}from"../../../../webgl/contextUtils.js";import{SizedPixelFormat as d,PixelFormat as j,TextureSamplingMode as w,PixelType as P,TextureWrapMode as h}from"../../../../webgl/enums.js";import{Texture as x}from"../../../../webgl/Texture.js";import{TextureDescriptor as b}from"../../../../webgl/TextureDescriptor.js";const T=new Map;function g(r,e,o){const t=new b;return t.width=e,t.height=o,t.internalFormat=r.type===l.WEBGL2?d.RGBA32F:j.RGBA,t.samplingMode=w.NEAREST,t.dataType=P.FLOAT,t.isImmutable=r.type===l.WEBGL2,t.wrapMode=h.CLAMP_TO_EDGE,t}function A(r,e,o,t){const{context:s,requestRender:n,allowDelayedRender:c}=r,i=t.createProgram(r,o);if(c&&null!=n&&!i.compiled)return n(),null;const{width:m,height:a}=o;return s.bindFramebuffer(e),s.setViewport(0,0,m,a),s.useProgram(i),i}function B(r){return T.get(r.toLowerCase())}function v(r,e,o,t){const s=r.rasterFunction.name.toLowerCase(),n="reproject"===s?p:B(s);if(null==n)return;const c=A(r,o,t,n);if(!c)return;n.bindTextureAndUniforms(r,c,t),e.draw();const{width:i,height:m}=t,a=g(r.context,i,m),u=new x(r.context,a);if(o.copyToTexture(0,0,i,m,0,0,u),"reproject"===s)t.rasterTexture=u,t.projected=!0;else{const e=r.hasBranches?r.rasterFunction.id:0;t.functionTextures[e]=u}}T.set("aspect",r),T.set("bandarithmetic",e),T.set("compositeband",o),T.set("convolution",t),T.set("curvature",s),T.set("extractband",n),T.set("local",c),T.set("mask",i),T.set("ndvi",m),T.set("remap",a),T.set("slope",u),T.set("stretch",f);export{g as createTextureDescriptor,v as process};
