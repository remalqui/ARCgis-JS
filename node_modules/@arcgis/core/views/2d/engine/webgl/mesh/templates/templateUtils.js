/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{e as t}from"../../../../../../chunks/earcut.js";import{triangulate as e}from"../../../../../../geometry/libtess.js";import{TileClipper as n,GeometryType as o}from"../../../../../../geometry/support/TileClipper.js";import r from"../../../../../../layers/graphics/OptimizedGeometry.js";import{TILE_SIZE as s}from"../../definitions.js";import{bufcut as l}from"../bufcut.js";const i=1e-5,f=new n(0,0,0,1,0),u=new n(0,0,0,1,0);function c(t,e,n){let o=0;for(let r=1;r<n;r++){const n=t[2*(e+r-1)],s=t[2*(e+r-1)+1];o+=(t[2*(e+r)]-n)*(t[2*(e+r)+1]+s)}return o}function h(t,e,n,o,r){let s=0;const l=2;for(let i=n;i<o;i+=3){const n=(t[i]-r)*l,o=(t[i+1]-r)*l,f=(t[i+2]-r)*l;s+=Math.abs((e[n]-e[f])*(e[o+1]-e[n+1])-(e[n]-e[o])*(e[f+1]-e[n+1]))}return s}function a(t,e){const{coords:n,lengths:o,hasIndeterminateRingOrder:r}=e,s=0,f=t;if(r)return!1;let u=0;for(let a=0;a<o.length;){let t=a,e=o[a],r=c(n,u,e);const g=[];for(;++t<o.length;){const s=o[t],l=c(n,u+e,s);if(!(l>0))break;r+=l,g.push(u+e),e+=s}const p=f.length;l(f,n,u,u+e,g,2,s);const m=h(f,n,p,f.length,s),d=Math.abs(r);if(Math.abs((m-d)/Math.max(1e-7,d))>i)return f.length=0,!1;a=t,u+=e}return!0}function g(e,n,o){const{coords:r,lengths:s,hasIndeterminateRingOrder:l}=n;if(l)return!1;let i=0;for(let f=0;f<s.length;){let l=f,u=s[f];const h=[];for(;++l<s.length;){const t=s[l];if(!(c(r,i+u,t)>0))break;h.push(i+u-i),u+=t}const a=i+u,g=n.coords.slice(2*i,2*a),p=t(g,h,2);for(const t of p)e.push(t+o+i);f=l,i+=u}return!0}function p(t){const{coords:n,lengths:o}=t,{buffer:r}=e(n,o);return r}function m(t,e,n){let o=0;for(let r=0;r<t.lengths.length;r++){const s=t.lengths[r];for(let r=0;r<s;r++){const s=t.coords[2*(r+o)],l=t.coords[2*(r+o)+1];if(s<e||s>n||l<e||l>n)return!0}o+=s}return!1}function d(t,e){if(null==t)return null;if(!m(t,-128,s+128))return t;f.setPixelMargin(e),f.reset(o.Polygon);let n=0;for(let o=0;o<t.lengths.length;o++){const e=t.lengths[o];let r=t.coords[2*(0+n)],s=t.coords[2*(0+n)+1];f.moveTo(r,s);for(let o=1;o<e;o++)r=t.coords[2*(o+n)],s=t.coords[2*(o+n)+1],f.lineTo(r,s);f.close(),n+=e}const l=f.result(!1);if(!l)return null;const i=[],u=[];for(const o of l){let t=0;for(const e of o)u.push(e.x),u.push(e.y),t++;i.push(t)}return new r(i,u)}function x(t,e){u.setPixelMargin(e);const n=u,r=-e,l=s+e;let i=[],f=!1;if(!t.nextPath())return null;let c=!0;for(;c;){t.seekPathStart();const e=[];if(!t.numPoints)return null;n.reset(o.LineString),t.nextPoint();let s=t.x,u=t.y;if(f)n.moveTo(s,u);else{if(s<r||s>l||u<r||u>l){f=!0;continue}e.push({x:s,y:u})}let h=!1;for(;t.nextPoint();)if(s=t.x,u=t.y,f)n.lineTo(s,u);else{if(s<r||s>l||u<r||u>l){h=!0;break}e.push({x:s,y:u})}if(h)f=!0;else{if(f){const t=n.resultWithStarts();if(t)for(const e of t)i.push(e)}else i.push({line:e,start:0});c=t.nextPath(),f=!1}}return i=i.filter((t=>t.line.length>1)),0===i.length?null:i}f.setExtent(s),u.setExtent(s);export{c as area,x as clipLinesMarshall,d as clipMarshall,h as triangleAreaArray,a as triangulate,g as triangulateEarcut,p as triangulateLibtess};
