/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import e from"../../../core/Evented.js";import{EditGeometry as t}from"./EditGeometry.js";import{AccumulationBehaviour as r}from"./interfaces.js";import{AppendVertex as o}from"./operations/AppendVertex.js";import{UpdateVertices as s,AccumulationType as i}from"./operations/UpdateVertices.js";import{RemoveVertices as n}from"./operations/RemoveVertices.js";import{SplitEdge as a}from"./operations/SplitEdge.js";import{SetVertexPosition as p}from"./operations/SetVertexPosition.js";import{CloseComponent as d}from"./operations/CloseComponent.js";import{MoveVertex as c}from"./operations/MoveVertex.js";import{OffsetEdgeVertex as u}from"./operations/OffsetEdgeVertex.js";import{RotateVertex as h}from"./operations/RotateVertex.js";import{ScaleVertex as m}from"./operations/ScaleVertex.js";import{UndoGroup as l}from"./operations/UndoGroup.js";class _ extends e{constructor(e){super(),this.data=e,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",(e=>{e.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:e.addedVertices,operation:e.operation}),e.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:e.removedVertices,operation:e.operation}),e.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:e.updatedVertices,operation:e.operation})}))}destroy(){this._listener.remove()}splitEdge(e,t){return this._apply(new a(this.data,e,t))}updateVertices(e,t,o=r.ACCUMULATE_STEPS){return this._apply(new s(this.data,e,t),o)}moveVertices(e,t,o,s,i=r.ACCUMULATE_STEPS){return this.updateVertices(e,new c(this.data.coordinateHelper,t,o,s),i)}scaleVertices(e,t,o,s,n,a=r.ACCUMULATE_STEPS,p=i.CUMULATIVE){return this.updateVertices(e,new m(t,o,s,n,p),a)}rotateVertices(e,t,o,s=r.ACCUMULATE_STEPS,n=i.CUMULATIVE){return this.updateVertices(e,new h(t,o,n),s)}removeVertices(e){return this._apply(new n(this.data,e,this._minNumVerticesPerType))}appendVertex(e){return 0===this.data.components.length?null:this._apply(new o(this.data,this.data.components[0],e))}setVertexPosition(e,t){return this._apply(new p(this.data,e,t))}offsetEdge(e,t,o,s=r.ACCUMULATE_STEPS){return this.updateVertices([t.leftVertex,t.rightVertex],new u(this.data.coordinateHelper,e,t,o),s)}closeComponent(e){return this.data.components.includes(e)?this._apply(new d(this.data,e)):null}canRemoveVertex(){return this.data.components[0].vertices.length>this._minNumVerticesPerType}createUndoGroup(){const e=new l;return this._apply(e),{remove:()=>e.close()}}undo(){if(this._undoStack.length>0){const e=this._undoStack.pop();return e.undo(),this._redoStack.push(e),e}return null}redo(){if(this._redoStack.length>0){const e=this._redoStack.pop();return e.apply(),this._undoStack.push(e),e}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(e,t=r.ACCUMULATE_STEPS){return t!==r.NEW_STEP&&null!=this.lastOperation&&this.lastOperation.accumulate(e)||(e.apply(),this._undoStack.push(e),this._redoStack=[]),e}static fromGeometry(e,r){return new _(t.fromGeometry(e,r))}}export{_ as EditGeometryOperations};
