/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{max as s}from"../../../../core/quantityUtils.js";import{w as o,s as i,g as t,A as n,B as r,c as a,i as e,a as c}from"../../../../chunks/vec2.js";import{a as g,I as b,g as u,b as f,h as m,f as p,n as I,e as d,l,A as N}from"../../../../chunks/vec3.js";import{f as h,Z as j}from"../../../../chunks/vec3f64.js";import{a as x,u as E}from"../../../../chunks/boundedPlane.js";import{sv2d as T,sv3d as V}from"../../../../geometry/support/vectorStacks.js";import{MoveVertex as v}from"../operations/MoveVertex.js";import{RotateVertex as R}from"../operations/RotateVertex.js";import{ScaleVertex as k}from"../operations/ScaleVertex.js";import{UpdateVertices as C}from"../operations/UpdateVertices.js";import{autoHorizontalDistanceByElevationMode as A}from"../../../support/automaticLengthMeasurementUtils.js";function F(s,o){return Y(s,o,!1)}function S(s,o){return Y(s,o,!0)}function Y(s,o,i){if(s instanceof C){if(s.operation instanceof v)return _(s.operation,o,i),!0;if(s.operation instanceof R)return y(s.operation,o,i),!0;if(s.operation instanceof k)return P(s.operation,o,i),!0}return!1}function _(s,o,i=!1){const t=i?-1:1,n=h(t*s.dx,t*s.dy,t*s.dz);g(o.origin,o.origin,n)}function y(s,o,i=!1){const t=i?-s.angle:s.angle;b(o.basis1,o.basis1,j,t),b(o.basis2,o.basis2,j,t)}function P(s,i,t=!1){const n=t?1/s.factor1:s.factor1,r=t?1/s.factor2:s.factor2;u(i.basis1,i.basis1,n),u(i.basis2,i.basis2,r),o(i.origin,i.origin,s.origin,s.axis1,n),o(i.origin,i.origin,s.origin,s.axis2,r)}function U(s,o,g,b){b||(b=x());const u=i(T.get(),s[1],-s[0]),f=i(T.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),m=i(T.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),p=T.get();o.components.forEach((o=>o.vertices.forEach((o=>{const a=o.pos;i(p,t(s,a),t(u,a)),n(f,f,p),r(m,m,p)}))));const I=1e-6,d=i(T.get(),m[0]-f[0]<I?g/2:0,m[1]-f[1]<I?g/2:0);return a(f,f,d),e(m,m,d),c(b.basis1,s,(m[0]-f[0])/2),c(b.basis2,u,(m[1]-f[1])/2),i(b.origin,f[0]*s[0]+f[1]*u[0],f[0]*s[1]+f[1]*u[1]),e(b.origin,b.origin,b.basis1),e(b.origin,b.origin,b.basis2),b}function G(s,o,i,t=0,n){n||(n=x()),o.toRenderCoords(s.origin,i,n.origin);const r=V.get();g(r,s.origin,s.basis1),g(r,r,s.basis2),o.toRenderCoords(r,i,r);const a=V.get();g(a,s.origin,s.basis1),f(a,a,s.basis2),o.toRenderCoords(a,i,a);const e=V.get();f(e,s.origin,s.basis1),f(e,e,s.basis2),o.toRenderCoords(e,i,e);const c=V.get();f(c,s.origin,s.basis1),g(c,c,s.basis2),o.toRenderCoords(c,i,c);const b=m(V.get(),r,a,.5);f(b,b,n.origin);const N=m(V.get(),e,c,.5);f(N,n.origin,N),m(n.basis1,b,N,.5);const h=m(V.get(),c,r,.5);f(h,h,n.origin);const j=m(V.get(),a,e,.5);f(j,n.origin,j),m(n.basis2,h,j,.5);const T=p(V.get(),n.basis1,n.basis2),v=p(T,T,n.basis1);return I(v,v),u(n.basis2,v,d(n.basis2,v)),u(n.basis1,n.basis1,1+t/l(n.basis1)),u(n.basis2,n.basis2,1+t/l(n.basis2)),E(n),n}function M(o,i,t,n){const r=V.get();f(r,f(r,o.origin,o.basis1),o.basis2);const a=V.get();N(a,r,o.basis1,2);const e=V.get();N(e,a,o.basis2,2);const c=V.get();N(c,r,o.basis2,2),r[2]=a[2]=e[2]=c[2]=i;const g=n?"on-the-ground":"absolute-height",b=s(A(r,a,t,g),A(c,e,t,g)),u=s(A(a,e,t,g),A(r,c,t,g));return null==u||null==b?null:[b,u]}export{F as apply,U as calculateOrientedBounds,M as mapPlaneAutoHorizontalSizeByElevationMode,G as mapPlaneToRenderPlane,S as unapply};
