/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{l as e,d as t}from"../../../chunks/vec2.js";import{a as i}from"../../../chunks/vec2f64.js";import{c as s}from"../../../chunks/vec3f64.js";import{absoluteHeightElevationInfo as r}from"../../../support/elevationInfoUtils.js";import{SnappingAlgorithm as o}from"./SnappingAlgorithm.js";import{anyMapPointToSnappingPoint as n,asSnappingPoint as p}from"./SnappingPoint.js";import{squaredScreenDistance as a}from"./snappingUtils.js";import{RightAngleTriangleSnappingCandidate as d}from"./candidates/RightAngleTriangleSnappingCandidate.js";import{vectorToScreenPoint as c}from"../support/viewUtils.js";import{projectPointToCircle as m}from"../../support/geometry2dUtils.js";class l extends o{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],s=[],r=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return s;const{view:o}=this,p=i.vertices[0],a=i.vertices[r-1],d=n(p.pos,o,t),c=n(a.pos,o,t);return this._processCandidateProposal(d,c,e,t,s),s}snapExistingVertex(e,t){const i=[],s=t.vertexHandle,r=s.component;if(r.edges.length<2)return i;if("polyline"===t.editGeometryOperations.data.type&&(0===s.index||s.index===r.vertices.length-1))return i;const{view:o}=this,p=n(s.leftEdge.leftVertex.pos,o,t),a=n(s.rightEdge.rightVertex.pos,o,t);return this._processCandidateProposal(p,a,e,t,i),i}_processCandidateProposal(i,o,n,l,f){if(!this.exceedsShortLineThreshold(i,o,l))return;const g=e(h,i,o,.5),u=.5*t(i,o),v=s();m(v,n,g,u),v[2]=n[2];const x=p(v),{spatialReference:j,pointer:y}=l,w=c(n,j,r,this.view);if(a(w,c(x,j,r,this.view))<this.squaredProximityThreshold(y)){if(this.isVertical(i,x)||this.isVertical(x,o))return;f.push(new d({targetPoint:x,point1:i,point2:o,isDraped:"on-the-ground"===l.elevationInfo?.mode}))}}}const h=i();export{l as RightAngleTriangleSnapper};
