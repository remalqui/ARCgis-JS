/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{eachAlways as e}from"../../../../../core/promiseUtils.js";import t from"../../../../Point.js";import{GLB as r}from"./glb.js";import{GLTF as o}from"./gltf.js";import{ImageOutputType as n,BufferOutputType as s}from"./types.js";export{AlphaMode,AttributeType,ColorMode,MeshMode}from"./types.js";import{isArrayBufferPNG as i,encodeBase64DataUri as a}from"./imageutils.js";export{Asset}from"./asset.js";export{Scene}from"./scene.js";export{Node}from"./node.js";const f="model.gltf",u="model.glb";function p(p,m,c){const l=new o(p,m=m||{},c);let g=l.params;g?g.origin||(g.origin=new t({x:-1,y:-1,z:-1})):g={origin:new t({x:-1,y:-1,z:-1})};const y=g.origin,d=l.gltf,j=d.extras?.promises??[];let x=1,b=1,h=null;return e(j).then((()=>{const e={origin:y};delete d.extras;const t="number"==typeof m.jsonSpacing?m.jsonSpacing:4,o=JSON.stringify(d,((t,r)=>{if("extras"!==t){if(r instanceof ArrayBuffer){if(i(r))switch(m.imageOutputType){case n.DataURI:case n.GLB:break;case n.External:default:{const t=`img${b}.png`;return b++,e[t]=r,t}}switch(m.bufferOutputType){case s.DataURI:return a(r);case s.GLB:if(h)throw new Error("Already encountered an ArrayBuffer, there should only be one in the GLB format.");return void(h=r);case s.External:default:{const t=`data${x}.bin`;return x++,e[t]=r,t}}}return r}}),t);return m.bufferOutputType===s.GLB||m.imageOutputType===n.GLB?e[u]=new r(o,h).buffer:e[f]=o,e}))}function m(e,t){return p(e,{bufferOutputType:s.GLB,imageOutputType:n.GLB,jsonSpacing:0},t)}export{s as BufferOutputType,n as ImageOutputType,u as MODEL_NAME_GLB,f as MODEL_NAME_GLTF,m as exportGLB,p as exportGLTF};
