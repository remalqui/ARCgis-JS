/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{e as n}from"../../chunks/earcut.js";import{isClockwise as t}from"./coordsUtils.js";import{doubleSubArray as e,doubleArrayFrom as o,newDoubleArray as r}from"./DoubleArray.js";import{compactIndices as s}from"./Indices.js";import{deduplicate as i}from"./meshUtils/deduplicate.js";function l(t){const r=f(t.rings,t.hasZ,a.CCW_IS_HOLE),l=new Array;let h=0,g=0;for(const o of r.polygons){const t=o.count,i=o.index,c=e(r.position,3*i,3*t),f=o.holeIndices.map((n=>n-i)),a=s(n(c,f,3));l.push({position:c,faces:a}),h+=c.length,g+=a.length}const u=c(l,h,g),p=Array.isArray(u.position)?i(u.position,3,{originalIndices:u.faces}):i(u.position.buffer,6,{originalIndices:u.faces});return u.position=o(new Float64Array(p.buffer)),u.faces=p.indices,u}function c(n,t,e){if(1===n.length)return n[0];const o=r(t),i=new Array(e);let l=0,c=0,f=0;for(const r of n){for(let n=0;n<r.position.length;n++)o[l++]=r.position[n];for(const n of r.faces)i[c++]=n+f;f=l/3}return{position:o,faces:s(i)}}function f(n,t,e){const o=n.length,s=new Array(o),i=new Array(o),l=new Array(o);let c=0,f=0,u=0,p=0;for(let r=0;r<o;++r)p+=n[r].length;const d=r(3*p);let y=0;for(let r=o-1;r>=0;r--){const p=n[r],m=e===a.CCW_IS_HOLE&&g(p);if(m&&1!==o)s[c++]=p;else{let n=p.length;for(let t=0;t<c;++t)n+=s[t].length;const e={index:y,pathLengths:new Array(c+1),count:n,holeIndices:new Array(c)};e.pathLengths[0]=p.length,p.length>0&&(l[u++]={index:y,count:p.length}),y=m?h(p,p.length-1,-1,d,y,p.length,t):h(p,0,1,d,y,p.length,t);for(let o=0;o<c;++o){const n=s[o];e.holeIndices[o]=y,e.pathLengths[o+1]=n.length,n.length>0&&(l[u++]={index:y,count:n.length}),y=h(n,0,1,d,y,n.length,t)}c=0,e.count>0&&(i[f++]=e)}}for(let r=0;r<c;++r){const n=s[r];n.length>0&&(l[u++]={index:y,count:n.length}),y=h(n,0,1,d,y,n.length,t)}return i.length=f,l.length=u,{position:d,polygons:i,outlines:l}}function h(n,t,e,o,r,s,i){r*=3;for(let l=0;l<s;++l){const s=n[t];o[r++]=s[0],o[r++]=s[1],o[r++]=i?s[2]:0,t+=e}return r/3}function g(n){return!t(n,!1,!1)}var a;!function(n){n[n.NONE=0]="NONE",n[n.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(a||(a={}));export{a as CounterClockwiseMode,f as pathsToTriangulationInfo,l as triangulate};
