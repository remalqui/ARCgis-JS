/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import e from"../../../core/Error.js";import{formatNumber as r}from"../../../intl/number.js";import{createClassBreaksRenderer as a,getField as s}from"../../../renderers/support/rasterRendererHelper.js";import{processRasterRendererParameters as t}from"../support/utils.js";async function n(r){const a=(r=await t(r)).layer,{rasterInfo:n}=a;if(n.bandCount>1)throw new e("raster-class-breaks-renderer:not-supported","Multiband raster is not supported");const{attributeTable:o}=n;r.field||(r.field=s(o,"value")?.name??"value");if(!(null!=o&&o.fields.find((e=>e.name.toLowerCase()===r.field?.toLowerCase())))&&null==n.histograms&&(await a.updateRasterInfoWithEstimatedStats({rasterFunction:r.rasterFunction,signal:r.signal}),null==n.histograms))throw new e("raster-class-breaks-renderer:not-supported","Histograms or raster attribute table is required on the source raster. Unable to estimate histograms");const{colors:l,numClasses:i}=r;if(l&&i&&l.length!==i)throw new e("raster-class-breaks-renderer:not-supported","The size of the `colors` parameter does not match 'numClasses'");return r.classificationMethod||(r.classificationMethod="natural-breaks"),r}async function o(r){r=await n(r);const s=a(r.layer.rasterInfo,r);if(null==s)throw new e("raster-class-breaks-renderer:not-supported","Class breaks renderer is not supported on this data");const t={minValue:s.minValue,maxValue:s.classBreakInfos[s.classBreakInfos.length-1].maxValue,normalizationTotal:null,classBreakInfos:s.classBreakInfos.map((e=>{const r=l(e.minValue,e.maxValue);return e.label=r,{minValue:e.minValue,maxValue:e.maxValue,label:r}}))};return{renderer:s,classBreaksResult:t}}function l(e,a){return r(e,{maximumFractionDigits:3})+" - "+r(a,{maximumFractionDigits:3})}export{o as createRenderer};
