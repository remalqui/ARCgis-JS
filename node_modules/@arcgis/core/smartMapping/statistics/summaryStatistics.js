/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import s from"../../core/Error.js";import{numericTypes as i,isDateField as r}from"../../layers/support/fieldUtils.js";import{verifyBasicFieldValidity as t,verifyFieldType as e,verifyFilterValidty as a}from"./support/utils.js";import{verifyBinningParams as n}from"../support/binningUtils.js";import{getNormalizationType as o,getFieldsList as l}from"../support/utils.js";import{binningCapableLayerTypes as m,defaultSupportedLayerTypes as p,createLayerAdapter as u,getLayerTypeLabels as f}from"../support/adapters/support/layerUtils.js";const d=[...i,"date","string"];async function c(i){if(!(i&&i.layer&&(i.field||i.valueExpression||i.sqlExpression)))throw new s("summary-statistics:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(i.valueExpression&&!i.sqlExpression&&!i.view)throw new s("summary-statistics:missing-parameters","View is required when 'valueExpression' is specified");i.forBinning&&n(i,"summary-statistics");const{layer:c,...y}=i,w=i.forBinning?m:p,v=u(c,w,i.forBinning);if(!v)throw new s("summary-statistics:invalid-parameters","'layer' must be one of these types: "+f(w).join(", "));const x={layerAdapter:v,...y};x.normalizationType=o(x);const E=null!=x.signal?{signal:x.signal}:null;await v.load(E);const g=x.field,h=x.normalizationType,j=x.valueExpression||x.sqlExpression,q=g?v.getField(g):null,z=await l({field:x.field,normalizationField:x.normalizationField,valueExpression:x.valueExpression}),B=t(v,z,"summary-statistics:invalid-parameters");if(B)throw B;if(q){const i=e(v,q,"summary-statistics:invalid-parameters",d);if(i)throw i;if(r(q)&&h)throw new s("summary-statistics:invalid-parameters","Normalization is not allowed for date fields")}else if(j&&h)throw new s("summary-statistics:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified");const F=a(x.filter,"summary-statistics:invalid-parameters");if(F)throw F;return x}async function y(s){const{layerAdapter:i,...r}=await c(s);return i.summaryStatistics(r)}export{y as default};
