/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import t from"./Handles.js";import{destroyMaybe as r}from"./maybe.js";import{BEFORE_DESTROY_SYMBOL as e}from"./accessorSupport/beforeDestroy.js";import{get as s}from"./accessorSupport/get.js";import{getPropertiesMetadata as o}from"./accessorSupport/metadata.js";import i from"./accessorSupport/Properties.js";import{set as c}from"./accessorSupport/set.js";import{getAccessorInterceptor as n}from"./accessorSupport/testSupport.js";import{removeTarget as a,watch as _}from"./accessorSupport/watch.js";import{property as l}from"./accessorSupport/decorators/property.js";import{subclass as h}from"./accessorSupport/decorators/subclass.js";var u,p;function d(t){if(null==t)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return t.constructor?.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const y=Symbol("Accessor-Handles"),f=Symbol("Accessor-Initialized");class m{static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:e,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const i=this;class c extends i{constructor(...t){super(...t),this.inherited=null,s&&s.apply(this,t)}}o(c.prototype);for(const o in t){const r=t[o];c.prototype[o]="function"==typeof r?function(...t){const e=this.inherited;let s;this.inherited=function(...t){if(i.prototype[o])return i.prototype[o].apply(this,t)};try{s=r.apply(this,t)}catch(c){throw this.inherited=e,c}return this.inherited=e,s}:t[o]}for(const o in r){const t=d(r[o]);l(t)(c.prototype,o)}return h(e)(c)}constructor(...t){if(this[u]=null,this[p]=!1,this.constructor===m)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const r=new i(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:r}),t.length>0&&this.normalizeCtorArgs&&(r.ctorArgs=this.normalizeCtorArgs.apply(this,t)),n()?.onInstanceConstruct(this),v.register(this,r.propertiesByName,this)}postscript(t){const r=this.__accessor__,e=r.ctorArgs||t;r.initialize(),e&&(this.set(e),r.ctorArgs=null),r.constructed(),this.initialize(),this[f]=!0}initialize(){}[e](){this[y]=r(this[y])}destroy(){this.destroyed||(v.unregister(this),a(this),this.__accessor__.destroy(),n()?.onInstanceDestroy(this))}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[f]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return s(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,r){return c(this,t,r),this}watch(t,r,e){return _(this,t,r,e)}own(t){this.addHandles(t)}addHandles(r,e){if(this.destroyed){const t=Array.isArray(r)?r:[r];for(const r of t)r.remove();return}let s=this[y];null==s&&(s=this[y]=new t),s.add(r,e)}removeHandles(t){const r=this[y];null!=r&&r.remove(t)}removeAllHandles(){const t=this[y];null!=t&&t.removeAll()}hasHandles(t){const r=this[y];return null!=r&&r.has(t)}_override(t,r){void 0===r?this.__accessor__.clearOverride(t):this.__accessor__.override(t,r)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_overrideIfSome(t,r){null==r?this.__accessor__.clearOverride(t):this.__accessor__.override(t,r)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,r){return this.__accessor__.internalSet(t,r),this}}u=y,p=f;const v=new FinalizationRegistry((t=>{for(const r of t.values())r.destroy()}));export{m as default};
