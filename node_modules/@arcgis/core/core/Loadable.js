/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as o}from"../chunks/tslib.es6.js";import t from"./Error.js";import{abortMaybe as s}from"./maybe.js";import{EsriPromise as r}from"./Promise.js";import{onAbortOrThrow as l,onAbort as e}from"./promiseUtils.js";import a from"./Warning.js";import{property as n}from"./accessorSupport/decorators/property.js";import{subclass as i}from"./accessorSupport/decorators/subclass.js";const d="not-loaded",h="loading",c="failed",u="loaded",p=r=>{let p=class extends r{constructor(...o){super(...o),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise((o=>{const s=this.load.bind(this);this.load=r=>{const a=new Promise(((o,s)=>{const e=l(r,s);this.destroyed&&s(new t("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(o,s).finally((()=>{e&&e.remove()}))}));if(this.loadStatus===d){this._set("loadStatus",h);const o=this._loadController=new AbortController;s({signal:o.signal}),e(o.signal,(()=>{this._promiseProps.abort()}))}return o(),a}}))),this.when((()=>{this._set("loadStatus",u),this._loadController=null}),(o=>{this._set("loadStatus",c),this._set("loadError",o),this._loadController=null}))}destroy(){this._loadController=s(this._loadController),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===u}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new t("load:cancelled","Cancelled")),this._loadController?.abort()),this}};return o([n({readOnly:!0})],p.prototype,"loaded",null),o([n({readOnly:!0})],p.prototype,"loadError",void 0),o([n({clonable:!1})],p.prototype,"loadStatus",void 0),o([n({type:[a],readOnly:!0})],p.prototype,"loadWarnings",null),p=o([i("esri.core.Loadable")],p),p};let m=class extends(p(r)){};m=o([i("esri.core.Loadable")],m),function(o){function t(o){return!(!o||!o.load)}o.LoadableMixin=p,o.isLoadable=t}(m||(m={}));const _=m;export{_ as default};
