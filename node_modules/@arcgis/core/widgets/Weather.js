/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{memoize as o}from"../core/memoize.js";import{property as t}from"../core/accessorSupport/decorators/property.js";import"../core/accessorSupport/ensureType.js";import"../core/arrayUtils.js";import"../core/has.js";import{subclass as r}from"../core/accessorSupport/decorators/subclass.js";import{weatherTypesArray as s}from"../views/3d/environment/weather.js";import i from"./Widget.js";import{loadCalciteComponents as n}from"./support/componentsUtils.js";import{Heading as a}from"./support/Heading.js";import{classes as l}from"./support/widgetUtils.js";import{messageBundle as c}from"./support/decorators/messageBundle.js";import{tsx as d,tsxFragment as p}from"./support/jsxFactory.js";import{CSS as u}from"./Weather/css.js";import{WeatherState as h,WeatherError as g}from"./Weather/enums.js";import{LabeledSlider as m}from"./Weather/LabeledSlider.js";import v from"./Weather/VisibleElements.js";import y from"./Weather/WeatherViewModel.js";const b={sunny:"brightness",cloudy:"partly-cloudy",rainy:"rain",snowy:"snow",foggy:"fog"};let w=class extends i{constructor(e){super(e),this.viewModel=new y,this.headingLevel=4,this.visibleElements=new v,this.iconClass=u.widgetIcon,this.icon=null,this._renderWeatherTypeButton=e=>{const o=this.viewModel,t=this.messages[e].label,r=o.state===h.Disabled,s=!r&&o.current.type===e;return d("calcite-button",{appearance:s?"solid":"outline","aria-checked":s?"true":"false",kind:s?"brand":"neutral",disabled:r,iconStart:b[e],key:`${e}-type-button`,label:t,scale:"l",title:t,onclick:()=>{s||o.setWeatherByType(e)}})},this._memoizedCallbacks=o((e=>({onCloudCoverChange:o=>{"cloudCover"in e&&(e.cloudCover=o)},onPrecipitationChange:o=>{"precipitation"in e&&(e.precipitation=o)},onFogStrengthChange:o=>{"fogStrength"in e&&(e.fogStrength=o)},onSnowCoverChange:e=>{this.viewModel.setSnowCoverEnabled(e.target.checked)}})))}render(){const e=this.viewModel.state===h.Disabled;return d("div",{class:this.classes(u.base,u.esriWidget,e&&u.esriWidgetDisabled),role:"region","aria-label":this.messages.widgetLabelAccessible},this._renderContent())}loadDependencies(){return n({button:()=>import("@esri/calcite-components/dist/components/calcite-button.js"),checkbox:()=>import("@esri/calcite-components/dist/components/calcite-checkbox.js"),icon:()=>import("@esri/calcite-components/dist/components/calcite-icon.js"),label:()=>import("@esri/calcite-components/dist/components/calcite-label.js")})}get view(){return this.viewModel?.view}set view(e){this.viewModel&&(this.viewModel.view=e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get _errorMessage(){const e=this.messages.error;switch(this.viewModel.error){case g.LocalScene:return e.localScene;case g.NoAtmosphere:return e.noAtmosphere;case g.UnsupportedView:return e.unsupported;default:return null}}get _warningMessage(){if(this.viewModel.error===g.NotVisible){return null!=this.view&&"3d"===this.view?.type&&this.view.environment.atmosphereEnabled?this.messages.error.notVisible:null}return null}_renderContent(){const e=this.messages,o=this._warningMessage,t=this.viewModel.state===h.Error;return d(p,null,this.visibleElements.header&&d(a,{level:this.headingLevel},e.widgetLabel),t&&d("div",{key:"error",class:u.error},this._errorMessage),d("div",{key:"content",class:l({[u.content]:!0,[u.hasError]:t})},d("div",{class:u.selector,role:"radiogroup","aria-label":e.weatherType},s.map(this._renderWeatherTypeButton)),d("div",{class:u.options},this._renderOptions()),null!=o?this._renderWarning(o):null))}_renderOptions(){const{viewModel:e,messages:o}=this,t=e.state===h.Disabled,r=e.current,s=this._memoizedCallbacks(r);switch(r.type){case"sunny":return d(m,{key:"sunny-cover",disabled:t,label:o.sunny.cloudCover,value:r.cloudCover,onChange:s.onCloudCoverChange});case"cloudy":return d(m,{key:"cloudy-cover",disabled:t,label:o.cloudy.cloudCover,value:r.cloudCover,onChange:s.onCloudCoverChange});case"rainy":return d(p,null,d(m,{key:"rainy-cover",disabled:t,label:o.rainy.cloudCover,value:r.cloudCover,onChange:s.onCloudCoverChange}),d(m,{key:"rainy-precipitation",disabled:t,label:o.rainy.precipitation,value:r.precipitation,onChange:s.onPrecipitationChange}));case"snowy":return d(p,null,d(m,{key:"snowy-cloud-cover",disabled:t,label:o.snowy.cloudCover,value:r.cloudCover,onChange:s.onCloudCoverChange}),d(m,{key:"snowy-precipitation",disabled:t,label:o.snowy.precipitation,value:r.precipitation,onChange:s.onPrecipitationChange}),d("calcite-label",{key:"snow-cover",scale:"s",layout:"inline",title:o.snowy.snowCoverTooltip},d("calcite-checkbox",{checked:"enabled"===r.snowCover,disabled:t,onCalciteCheckboxChange:s.onSnowCoverChange}),o.snowy.snowCover));case"foggy":return d(m,{key:"foggy-cover",disabled:t,label:o.foggy.fogStrength,value:r.fogStrength,onChange:s.onFogStrengthChange})}}_renderWarning(e){return d("div",{key:"warning",class:u.warning},d("calcite-icon",{icon:"exclamation-mark-triangle",scale:"s"}),e)}};e([t()],w.prototype,"viewModel",void 0),e([t()],w.prototype,"view",null),e([t()],w.prototype,"headingLevel",void 0),e([t({type:v,nonNullable:!0})],w.prototype,"visibleElements",void 0),e([t()],w.prototype,"iconClass",void 0),e([t()],w.prototype,"icon",void 0),e([t()],w.prototype,"label",null),e([t(),c("esri/widgets/Weather/t9n/Weather")],w.prototype,"messages",void 0),e([t()],w.prototype,"_errorMessage",null),e([t()],w.prototype,"_warningMessage",null),w=e([r("esri.widgets.Weather")],w);const C=w;export{C as default};
