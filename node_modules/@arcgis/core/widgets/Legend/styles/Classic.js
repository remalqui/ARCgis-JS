/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../intl.js";import{property as s}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/accessorSupport/ensureType.js";import"../../../core/arrayUtils.js";import"../../../core/has.js";import{subclass as t}from"../../../core/accessorSupport/decorators/subclass.js";import a from"../../Widget.js";import{CSS as r,LEGEND as i}from"./ClassicCSS.js";import{renderRelationshipRamp as l}from"./support/relationshipUtils.js";import{getUnivariateAboveAndBelowRampElements as o,getUnivariateColorRampSize as n,getUnivariateColorRampPreview as p,getUnivariateColorRampMargin as d,getUnivariateColorSizeRampElements as c}from"./support/univariateUtils.js";import{getTitle as m,isRendererTitle as y,attachToNode as v,isImageryStretchedLegend as h}from"../support/styleUtils.js";import{Heading as g}from"../../support/Heading.js";import"../../support/widgetUtils.js";import{messageBundle as u}from"../../support/decorators/messageBundle.js";import{tsx as b}from"../../support/jsxFactory.js";import{formatNumber as f}from"../../../intl/number.js";const L=`${i}__`,w=24,C={display:"flex",alignItems:"flex-start"},R={marginLeft:"3px"},_={display:"table-cell",verticalAlign:"middle"};let A=class extends a{constructor(e,s){super(e,s),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,s=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return b("div",null,s&&s.length?s:b("div",{class:r.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const s=!!e.children.length,t=`${L}${e.layer.uid}-version-${e.version}`,a=e.title?g({level:this.headingLevel,class:this.classes(r.header,r.label)},e.title):null;if(s){const s=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return b("div",{key:t,class:this.classes(r.service,r.groupLayer)},a,s)}{const s=e.legendElements;if(s&&!s.length)return null;const i=s.map((s=>this._renderLegendForElement(s,e.layer,e.effectList))).filter((e=>!!e));if(!i.length)return null;const l={[r.groupLayerChild]:!!e.parent};return b("div",{key:t,class:this.classes(r.service,l),tabIndex:0},a,b("div",{class:r.layer},i))}}_renderLegendForElement(e,s,t,a){const i="color-ramp"===e.type,o="opacity-ramp"===e.type,n="size-ramp"===e.type;let p=null;if("symbol-table"===e.type||n){const a=e.infos.map((a=>this._renderLegendForElementInfo(a,s,t,n,e.legendType))).filter((e=>!!e));a.length&&(p=b("div",{class:r.layerBody},a))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?p=this._renderLegendForRamp(e,s.opacity):"relationship-ramp"===e.type?p=l(e,this.id,{opacity:s.opacity,effectList:t,ariaLabel:this.messages.previewRelationshipRampAriaLabel}):"pie-chart-ramp"===e.type?p=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?p=this._renderUnivariateAboveAndBelowRamp(e,s.opacity,t):"univariate-color-size-ramp"===e.type&&(p=this._renderUnivariateColorSizeRamp(e,s.opacity,t));if(!p)return null;const d=e.title;let c=null;if("string"==typeof d)c=d;else if(d){const e=m(this.messages,d,i||o);c=y(d,i||o)&&d.title?`${d.title} (${e})`:e}const v=a?r.layerChildTable:r.layerTable,h=c?b("div",{class:r.layerCaption},c):null,g={[r.layerTableSizeRamp]:n||!a};return b("div",{class:this.classes(v,g)},h,p)}_renderPieChartRamp(e){return b("div",{bind:e.preview,afterCreate:v})}_renderUnivariateAboveAndBelowRamp(e,s,t){const{sizeRampElement:a,colorRampElement:i}=o(e,s);if(!a)return null;const l=this.messages?.previewColorRampAriaLabel,c=n(a,"above",!0),m=n(a,"below",!0),y=12,h=p(i,{width:y,height:c,rampAlignment:"vertical",opacity:s,type:"above",effectList:t,ariaLabel:l}),g=p(i,{width:y,height:m,rampAlignment:"vertical",opacity:s,type:"below",effectList:t,ariaLabel:l}),u=d(a),f=a.infos.map((e=>e.label)),L=f.map(((e,s)=>{const t=2===s;return 0===s?b("div",{key:s,class:e?h?r.univariateAboveAndBelowLabel:r.rampLabel:void 0},e):t?b("div",null):null})),w=f.length-1,A=Math.floor(f.length/2),j=f.map(((e,s)=>s===A||s===w?b("div",{key:s,class:e?h?r.univariateAboveAndBelowLabel:r.rampLabel:void 0},e):null)),S={display:"table-cell",verticalAlign:"middle"},I={marginTop:`${u}px`},$={height:`${c}px`},x={height:`${m}px`};return b("div",{key:"univariate-above-and-below-ramp-preview",styles:C},b("div",{class:r.layerBody},a.infos.map(((e,s)=>b("div",{class:this.classes(r.layerRow,r.sizeRamp)},b("div",{class:r.symbol,styles:S,bind:e.preview,afterCreate:v}),h||s%2!=0?null:b("div",{class:r.layerInfo},f[s]))))),h?b("div",{styles:I,key:"color-ramp-preview"},b("div",{styles:R},b("div",{styles:_},b("div",{class:r.rampContainer,bind:h,afterCreate:v})),b("div",{styles:_},b("div",{class:r.rampLabelsContainer,styles:$},L))),b("div",{styles:R},b("div",{styles:_},b("div",{class:r.rampContainer,bind:g,afterCreate:v})),b("div",{styles:_},b("div",{class:r.rampLabelsContainer,styles:x},j)))):null)}_renderUnivariateColorSizeRamp(e,s,t){const{sizeRampElement:a,colorRampElement:i}=c(e);if(!a)return null;const l=d(a),o=12,m=n(a,"full",!1),y=p(i,{width:o,height:m,rampAlignment:"vertical",opacity:s,type:"full",effectList:t,ariaLabel:this.messages?.previewColorRampAriaLabel}),h=a.infos.length-1,g=a.infos.map(((e,s)=>0===s||s===h?b("div",{key:s,class:e.label?i?r.univariateAboveAndBelowLabel:r.rampLabel:void 0},e.label):null)),u={display:"table-cell",verticalAlign:"middle"},f={marginTop:`${l}px`},L={height:`${m}px`};return b("div",{key:"univariate-above-and-below-ramp-preview",styles:C},b("div",{class:r.layerBody},a.infos.map((e=>b("div",{class:this.classes(r.layerRow,r.sizeRamp)},b("div",{class:r.symbol,styles:u,bind:e.preview,afterCreate:v}))))),b("div",{styles:f,key:"color-ramp-preview"},b("div",{styles:R},b("div",{styles:_},b("div",{class:r.rampContainer,bind:y,afterCreate:v})),b("div",{styles:_},b("div",{class:r.rampLabelsContainer,styles:L},g)))))}_renderLegendForRamp(e,s){const t=e.infos,a="opacity-ramp"===e.type,i="heatmap-ramp"===e.type,l="stretch-ramp"===e.type,o=e.preview,n=a?r.opacityRamp:"";o.className=`${r.colorRamp} ${n}`,null!=s&&(o.style.opacity=s.toString());const p=t.map((e=>b("div",{class:e.label?r.rampLabel:void 0},i?this.messages[e.label]||e.label:l?this._getStretchStopLabel(e):e.label))),d={width:`${w}px`},c={height:o.style.height};return b("div",{class:r.layerRow},b("div",{class:r.symbolContainer,styles:d},b("div",{class:r.rampContainer,bind:o,afterCreate:v})),b("div",{class:r.layerInfo},b("div",{class:r.rampLabelsContainer,styles:c},p)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:f(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}_renderLegendForElementInfo(e,s,t,a,i){if(e.type)return this._renderLegendForElement(e,s,t,!0);let l=null;const o=h(s,i);if(e.preview?l=b("div",{class:r.symbol,bind:e.preview,afterCreate:v}):e.src&&(l=this._renderImage(e,s,o)),!l)return null;const n={[r.imageryLayerInfoStretched]:o},p={[r.imageryLayerInfoStretched]:o,[r.sizeRamp]:!o&&a};return b("div",{class:r.layerRow},b("div",{class:this.classes(r.symbolContainer,p)},l),b("div",{class:this.classes(r.layerInfo,n)},m(this.messages,e.label,!1)||""))}_renderImage(e,s,t){const{label:a,src:i,opacity:l}=e,o={[r.imageryLayerStretchedImage]:t,[r.symbol]:!t},n={opacity:`${null!=l?l:s.opacity}`};return b("img",{alt:m(this.messages,a,!1),"aria-label":m(this.messages,a,!1),src:i,border:0,width:e.width,height:e.height,class:this.classes(o),styles:n})}};e([s()],A.prototype,"activeLayerInfos",void 0),e([s()],A.prototype,"headingLevel",void 0),e([s(),u("esri/widgets/Legend/t9n/Legend")],A.prototype,"messages",void 0),e([s({readOnly:!0})],A.prototype,"type",void 0),A=e([t("esri.widgets.Legend.styles.Classic")],A);const j=A;export{j as default};
