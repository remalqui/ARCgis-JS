/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import{isSome as t}from"../../core/arrayUtils.js";import{destroyMaybe as i}from"../../core/maybe.js";import{generateUID as s}from"../../core/uid.js";import{property as l}from"../../core/accessorSupport/decorators/property.js";import{cast as n}from"../../core/accessorSupport/decorators/cast.js";import"../../core/has.js";import{subclass as a}from"../../core/accessorSupport/decorators/subclass.js";import o from"../Widget.js";import{loadCalciteComponents as r}from"./componentsUtils.js";import"./widgetUtils.js";import{messageBundle as c}from"./decorators/messageBundle.js";import{tsx as d}from"./jsxFactory.js";import p from"./SnappingControls/SnappingControlsViewModel.js";const g={header:!0,enabledToggle:!0,selfEnabledToggle:!0,featureEnabledToggle:!0,layerList:!0,layerListToggleLayersButton:!0},h="esri-snapping-controls",m={base:h,container:`${h}__container`,panel:`${h}__panel`,item:`${h}__item`,toggleBlock:`${h}__toggle-block`,layerListBlock:`${h}__layer-list-block`,layerList:`${h}__layer-list`,layerListFilter:`${h}__layer-list__filter`,layerListButton:`${h}__layer-list__button`,layerListItem:`${h}__layer-list__item`,layerListGroup:`${h}__layer-list__group`,nestedContainer:`${h}__nested-container`,disabled:"esri-disabled",esriWidget:"esri-widget",widgetIcon:"esri-icon-vertex-gps"},u={checked:"check-square-f",unchecked:"square",indeterminate:"minus-square"};let b=class extends o{constructor(e,t){super((()=>{const{view:t,viewModel:i,snappingOptions:s,...l}=e;return l})(),t),this._defaultViewModel=null,this._layerListFilter=null,this.iconClass=m.widgetIcon,this.icon=null,this.layerListOpen=!0,this.messages=null,this.visibleElements={...g},this._onToggleLayersButtonClick=e=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),requestAnimationFrame((()=>e.target.setFocus()))},e?.viewModel?this.viewModel=e.viewModel:(this._defaultViewModel=new p({snappingOptions:e.snappingOptions,view:e.view}),this.viewModel=this._defaultViewModel)}destroy(){this._defaultViewModel=i(this._defaultViewModel)}loadDependencies(){return r({accordion:()=>import("@esri/calcite-components/dist/components/calcite-accordion.js"),"accordion-item":()=>import("@esri/calcite-components/dist/components/calcite-accordion-item.js"),action:()=>import("@esri/calcite-components/dist/components/calcite-action.js"),block:()=>import("@esri/calcite-components/dist/components/calcite-block.js"),button:()=>import("@esri/calcite-components/dist/components/calcite-button.js"),icon:()=>import("@esri/calcite-components/dist/components/calcite-icon.js"),input:()=>import("@esri/calcite-components/dist/components/calcite-input.js"),label:()=>import("@esri/calcite-components/dist/components/calcite-label.js"),list:()=>import("@esri/calcite-components/dist/components/calcite-list.js"),"list-item":()=>import("@esri/calcite-components/dist/components/calcite-list-item.js"),panel:()=>import("@esri/calcite-components/dist/components/calcite-panel.js"),switch:()=>import("@esri/calcite-components/dist/components/calcite-switch.js")})}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(null!=this._defaultViewModel&&this._defaultViewModel===e||(this._defaultViewModel=i(this._defaultViewModel)),this._set("viewModel",e))}castVisibleElements(e){return{...g,...e}}render(){const{label:e,visibleElements:{header:t}}=this;return d("div",{"aria-label":e,class:this.classes(m.base,m.esriWidget)},d("div",{class:m.container},t?this._renderHeaderView():this._renderContent()))}_renderHeaderView(){return d("calcite-panel",{heading:this.label,class:m.panel},this._renderContent())}_renderContent(){return[this._renderToggles(),this._renderLayerList()]}_renderToggles(){const{visibleElements:{enabledToggle:e,selfEnabledToggle:t,featureEnabledToggle:i}}=this;return e||t||i?d("calcite-block",{class:m.toggleBlock,key:"toggle-block",heading:"",open:!0},this._renderEnabledToggle(),d("div",{class:m.nestedContainer},this._renderSelfEnabledToggle(),this._renderFeatureEnabledToggle())):null}_renderEnabledToggle(){if(!this.visibleElements.enabledToggle)return null;const{messages:{enableSnapping:e},viewModel:{snappingOptions:{enabled:t,enabledToggled:i}}}=this;return d("calcite-label",{layout:"inline-space-between"},e,d("calcite-switch",{checked:t,disabled:i,bind:this,onCalciteSwitchChange:this._enableSnappingSwitchChange}))}_renderSelfEnabledToggle(){if(!this.visibleElements.selfEnabledToggle)return null;const{messages:{geometryGuides:e},viewModel:{snappingOptions:{enabled:t,selfEnabled:i,enabledToggled:s}}}=this;return d("calcite-label",{layout:"inline-space-between",key:"self-enabled-toggle"},e,d("calcite-switch",{checked:i,disabled:s||!t,bind:this,onCalciteSwitchChange:this._selfEnabledSwitchChange}))}_renderFeatureEnabledToggle(){if(!this.visibleElements.featureEnabledToggle)return null;const{messages:{featureToFeature:e},viewModel:{snappingOptions:{enabled:t,featureEnabled:i,enabledToggled:s}}}=this;return d("calcite-label",{layout:"inline-space-between",key:"feature-enabled-toggle"},e,d("calcite-switch",{checked:i,disabled:s||!t,bind:this,onCalciteSwitchChange:this._featureEnabledSwitchChange}))}_renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:t}=this,{snappingOptions:{enabled:i,enabledToggled:s}}=t,l=({target:{value:e}})=>this._layerListFilter=""===e?null:new RegExp(e,"i"),n=t.layerListViewModel.operationalItems.length>9?d("calcite-input",{class:m.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:l}):null,a=s||!i,o=this.layerListOpen&&!a;return d("calcite-block",{key:"list-block",heading:e.snappingLayers,disabled:a,class:m.layerListBlock,collapsible:!0,open:o,onCalciteBlockToggle:e=>this.layerListOpen=e.target.open},n,this._renderToggleLayersButton(),d("calcite-list",{class:m.layerList},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems,this._layerListFilter)))}_renderLayerListItemCollection(e,i){return e.map((e=>{if(!i||this._itemTitleMatchesFilter(e,i))return e.children.length>0?this._renderLayerListItemGroup(e):this._renderLayerListItem(e);const t=e.children.filter((e=>this._itemTitleMatchesFilter(e,i)));return t.length>0?this._renderLayerListItemGroup(e,t):null})).toArray().filter(t)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:t}=this,i=e?t.disableAllLayers:t.enableAllLayers;return d("calcite-button",{appearance:"transparent",class:m.layerListButton,label:i,name:"layer-toggle",scale:"m",onclick:this._onToggleLayersButtonClick},i)}_renderLayerListItem(e){const{messages:{untitledLayer:t}}=this,i=e.title||t,s=e.enabled,l=()=>{this._handleLayerListItemChange({checked:!s,value:e.layer.id})};return d("calcite-list-item",{class:m.layerListItem,label:i,key:`${this.id}-list-item-${e.uid}`,onCalciteListItemSelect:l},d("calcite-icon",{icon:s?u.checked:u.unchecked,slot:"content-start",scale:"s"}))}_renderLayerListItemGroup(e,t){const{allChildrenEnabled:i,children:l,hasChildrenEnabled:n,title:a}=e,o=this.messages,r=a||o.untitledLayer,c=a&&""!==a?a:s(),p=!!t,g=t??l,h=i?u.checked:n?u.indeterminate:u.unchecked,b=i?o.disableAllLayers:o.enableAllLayers,y=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,!i)};return d("calcite-list-item",{class:m.layerListItem,key:c},d("calcite-accordion",{class:m.layerListGroup,appearance:"transparent"},d("calcite-accordion-item",{expanded:p,heading:r,key:e.uid},d("calcite-action",{scale:"m",slot:"actions-start",text:b,textEnabled:!1,onclick:y},d("calcite-icon",{icon:h,scale:"s"})),d("calcite-list",null,[...this._renderLayerListItemCollection(g)]))))}_enableSnappingSwitchChange(e){this.snappingOptions.enabled=e.target.checked}_featureEnabledSwitchChange(e){this.snappingOptions.featureEnabled=e.target.checked}_itemTitleMatchesFilter(e,t){return null!=t&&t.test(e.title)}_selfEnabledSwitchChange(e){this.snappingOptions.selfEnabled=e.target.checked}async _handleLayerListItemChange(e){e.checked?this.viewModel.enableSnappingForLayer(e.value):this.viewModel.disableSnappingForLayer(e.value)}};e([l()],b.prototype,"_defaultViewModel",void 0),e([l()],b.prototype,"_layerListFilter",void 0),e([l()],b.prototype,"iconClass",void 0),e([l()],b.prototype,"icon",void 0),e([l()],b.prototype,"label",null),e([l()],b.prototype,"layerListOpen",void 0),e([l(),c("esri/widgets/support/SnappingControls/t9n/SnappingControls")],b.prototype,"messages",void 0),e([l()],b.prototype,"snappingOptions",null),e([l()],b.prototype,"view",null),e([l()],b.prototype,"viewModel",null),e([l()],b.prototype,"visibleElements",void 0),e([n("visibleElements")],b.prototype,"castVisibleElements",null),b=e([a("esri.widgets.support.SnappingControls")],b);const y=b;export{y as default};
