/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import{watch as t,initial as r}from"../../core/reactiveUtils.js";import{property as s}from"../../core/accessorSupport/decorators/property.js";import"../../core/accessorSupport/ensureType.js";import"../../core/arrayUtils.js";import"../../core/has.js";import{subclass as l}from"../../core/accessorSupport/decorators/subclass.js";import{getEffectiveLayerCapabilities as i,isTable as o}from"../../layers/support/layerUtils.js";import a from"../Feature/FeatureRelationship/FeatureRelationshipViewModel.js";import{isRelatableFeatureSupportedLayer as n}from"../Feature/support/featureUtils.js";import p from"./EditableInput.js";const d=3;let u=class extends p{constructor(e){super(e),this._relationshipVM=null,this.group=null,this.type="relationship",this.handles.add([t((()=>({feature:this.feature,element:this.element,layer:this.layer})),(e=>this._createRelationshipVM(e)),r)])}destroy(){this._relationshipVM?.destroy()}get canAddRelatedFeature(){const{editable:e,featureCount:t,_relationshipVM:r}=this;if(!r?.relationship||!this.loaded||!this.relatedLayerAllowsAdds)return!1;const{cardinality:s,role:l}=r.relationship;return!("one-to-one"===s&&t>0)&&("many-to-many"!==s&&(!("one-to-many"===s&&"destination"===l&&t>0)&&e))}get displayCount(){return this.element.displayCount??d}get displayType(){return this.element.displayType}get editable(){return!!this.relatedLayerAllowsEdits&&(this.evaluatedEditableExpression??!1)}get featureCount(){return this._relationshipVM?.featureCount??0}get map(){return this._get("map")}set map(e){e&&this._relationshipVM?.set("map",e),this._set("map",e)}get orderByFields(){return this.element.orderByFields}get relationshipId(){return this.element.relationshipId}get relatedFeatureInfos(){return this._relationshipVM?.relatedFeatureInfos??[]}get relatedLayer(){return this._relationshipVM?.relatedLayer}get relatedLayerAllowsAdds(){const{relatedLayer:e}=this;if(!e||!this.relatedLayerAllowsEdits)return!1;const t=i(e);return!!t?.operations?.supportsAdd}get relatedLayerAllowsEdits(){const{relatedLayer:e}=this;if(!e)return!1;const t=i(e);return!!t?.operations?.supportsEditing}get showAllEnabled(){return this._get("showAllEnabled")}set showAllEnabled(e){this._relationshipVM?.set("showAllEnabled",e),this._set("showAllEnabled",e)}get showAllActionVisible(){return!this.showAllEnabled&&this.featureCount>0&&this.featureCount>this.displayCount}get visible(){const{_relationshipVM:e,relatedLayer:t}=this;if(!e?.relationship)return!1;const{cardinality:r}=e.relationship;return"many-to-many"!==r&&(!(t&&!o(t))&&(null!=this.evaluatedVisibilityExpression?this.evaluatedVisibilityExpression:null!=this.element))}get updating(){return"loading"===this._relationshipVM?.state||"querying"===this._relationshipVM?.state}get loaded(){return"ready"===this._relationshipVM?.state}incrementPage(){this._relationshipVM&&this._relationshipVM.featurePage++}getRelatedFeatureByObjectId(e){return this._relationshipVM?.getRelatedFeatureByObjectId(e)}_createRelationshipVM(e){const{feature:t,element:r,layer:s}=e;if(this._relationshipVM?.destroy(),!t||!r||!s)return;const{displayCount:l,map:i,orderByFields:o,relationshipId:p,showAllEnabled:d}=this;n(s)&&(this._relationshipVM=new a({graphic:t,displayCount:l,layer:s,map:i,orderByFields:o,relationshipId:p,showAllEnabled:d}))}};e([s()],u.prototype,"canAddRelatedFeature",null),e([s()],u.prototype,"displayCount",null),e([s()],u.prototype,"displayType",null),e([s()],u.prototype,"editable",null),e([s()],u.prototype,"group",void 0),e([s()],u.prototype,"map",null),e([s()],u.prototype,"orderByFields",null),e([s()],u.prototype,"relationshipId",null),e([s()],u.prototype,"relatedFeatureInfos",null),e([s()],u.prototype,"relatedLayer",null),e([s()],u.prototype,"relatedLayerAllowsAdds",null),e([s()],u.prototype,"relatedLayerAllowsEdits",null),e([s()],u.prototype,"showAllEnabled",null),e([s()],u.prototype,"showAllActionVisible",null),e([s({readOnly:!0})],u.prototype,"type",void 0),e([s()],u.prototype,"visible",null),e([s()],u.prototype,"updating",null),e([s()],u.prototype,"incrementPage",null),e([s()],u.prototype,"getRelatedFeatureByObjectId",null),u=e([l("esri.widgets.FeatureForm.RelationshipInput")],u);const h=u;export{h as default};
