/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{HandleOwnerMixin as t}from"../core/HandleOwner.js";import{watch as r,initial as o}from"../core/reactiveUtils.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import{cast as i}from"../core/accessorSupport/decorators/cast.js";import"../core/arrayUtils.js";import"../core/has.js";import{subclass as n}from"../core/accessorSupport/decorators/subclass.js";import l from"./Widget.js";import{isTemplateItemGroup as a}from"./FeatureForm/featureFormUtils.js";import d from"./FeatureTemplates/FeatureTemplatesViewModel.js";import{ItemList as c}from"./FeatureTemplates/ItemList.js";import m from"./FeatureTemplates/TemplateItem.js";import{loadCalciteComponents as p}from"./support/componentsUtils.js";import"./support/widgetUtils.js";import{messageBundle as u}from"./support/decorators/messageBundle.js";import{vmEvent as h}from"./support/decorators/vmEvent.js";import{tsx as f}from"./support/jsxFactory.js";const v="esri-feature-templates",I={base:v,loader:`${v}__loader`,widget:"esri-widget"};function b(e){return e.length>0&&a(e[0])}function y(e){return e.id}const g={filter:!0};let w=class extends(t(l)){constructor(e,t){super(e,t),this.enableListScroll=!0,this.filterText="",this.headingLevel=4,this.messages=null,this.viewModel=new d,this.visibleElements={...g},this.renderCustomItem=e=>null,this.renderCustomGroupContent=e=>null,this.renderItemLabel=()=>null,this.renderItemDescription=()=>null,this.renderItemContent=e=>null,this.renderItemContentEnd=e=>null,this._iconIntersectionObserver=new IntersectionObserver(((e,t)=>{e.forEach((async e=>{if(e.isIntersecting){const r=e.target;if(j(r))return void t.unobserve(r);const o=C(r),{layer:s,template:i}=o;F(r,!0);const n=await m.fetchThumbnail(s,i).catch((()=>(F(r,!1),null)));if(null==n)return;r.appendChild(n)}}))})),this.renderItemIcon=e=>f("span",{key:"icon",afterCreate:this._afterItemCreateOrUpdate,afterUpdate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,"data-item":e,"data-has-icon":!1}),this._afterItemCreateOrUpdate=e=>{this._iconIntersectionObserver?.observe(e)},this._afterItemRemoved=e=>{this._iconIntersectionObserver?.unobserve(e)}}initialize(){const e=({label:e})=>!this.filterText||!!e?.toLowerCase().includes(this.filterText.toLowerCase());this.addHandles(r((()=>this.viewModel),((t,r)=>{t&&!t.filterFunction&&(this.filterFunction=e),r&&r!==t&&r.filterFunction===e&&(r.filterFunction=null)}),o))}destroy(){this._iconIntersectionObserver?.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return p({input:()=>import("@esri/calcite-components/dist/components/calcite-input.js"),"list-item":()=>import("@esri/calcite-components/dist/components/calcite-list-item.js"),notice:()=>import("@esri/calcite-components/dist/components/calcite-notice.js")})}get filterFunction(){return this.viewModel.filterFunction}set filterFunction(e){this.viewModel.filterFunction=e}get groupBy(){return this.viewModel.groupBy}set groupBy(e){this.viewModel.groupBy=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get selectedItem(){return this.viewModel.selectedItem}castVisibleElements(e){return{...g,...e}}select(e,t){return this.viewModel.select(e,t)}render(){const{enableListScroll:e,filterText:t,headingLevel:r,messages:o,viewModel:{items:s,numberOfFeatureTemplates:i,selectedItem:n,state:l}}=this,m=this.visibleElements.filter&&i>1;if(b(s)){const e=s.find((e=>e.label===d.nullGroupBy.label));e&&(e.label=o.other)}return f("div",{class:this.classes(I.base,I.widget),"aria-label":o.widgetLabel},"loading"===l?this.renderLoader():"ready"===l?f(c,{enableListScroll:e,filterEnabled:m,filterText:t,headingLevel:r,id:this.id,identify:y,items:s,messages:{filterPlaceholder:o.filterPlaceholder,noItems:o.noItems,noMatches:o.noMatches},renderIcon:this.renderItemIcon,renderCustomItem:this.renderCustomItem,renderCustomGroupContent:this.renderCustomGroupContent,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:n??void 0,selectionMode:"single",onItemSelect:e=>!a(e)&&this.viewModel.select(e),onFilterChange:e=>{this.filterText=e,this.viewModel.refresh()}}):null)}renderLoader(){return f("div",{class:I.loader,key:"loader"})}};function C(e){return e?.["data-item"]}function j(e){return!!e?.["data-has-icon"]}function F(e,t){e&&(e["data-has-icon"]=t)}e([s()],w.prototype,"enableListScroll",void 0),e([s()],w.prototype,"filterFunction",null),e([s()],w.prototype,"filterText",void 0),e([s()],w.prototype,"groupBy",null),e([s()],w.prototype,"headingLevel",void 0),e([s()],w.prototype,"label",null),e([s()],w.prototype,"layers",null),e([s(),u("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],w.prototype,"messages",void 0),e([s({readOnly:!0})],w.prototype,"selectedItem",null),e([s(),h("select")],w.prototype,"viewModel",void 0),e([s()],w.prototype,"visibleElements",void 0),e([i("visibleElements")],w.prototype,"castVisibleElements",null),e([s()],w.prototype,"renderCustomItem",void 0),e([s()],w.prototype,"renderCustomGroupContent",void 0),e([s()],w.prototype,"renderItemLabel",void 0),e([s()],w.prototype,"renderItemDescription",void 0),e([s()],w.prototype,"renderItemContent",void 0),e([s()],w.prototype,"renderItemContentEnd",void 0),w=e([n("esri.widgets.FeatureTemplates")],w);const L=w;export{L as default};
