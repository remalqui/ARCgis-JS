/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../TimeInterval.js";import{equals as i}from"../core/arrayUtils.js";import s from"../core/Collection.js";import{neverReached as n}from"../core/compilerUtils.js";import{applySome as a}from"../core/maybe.js";import{watch as o,initial as r}from"../core/reactiveUtils.js";import{truncateDate as l,offsetDate as u}from"../core/timeUtils.js";import{property as m}from"../core/accessorSupport/decorators/property.js";import"../core/accessorSupport/ensureType.js";import{subclass as d}from"../core/accessorSupport/decorators/subclass.js";import{formatDate as c,convertDateFormatToIntlOptions as p}from"../intl/date.js";import v from"./Slider.js";import h from"./Widget.js";import{loadCalciteComponents as w}from"./support/componentsUtils.js";import{accessibleHandler as f}from"./support/decorators/accessibleHandler.js";import{messageBundle as y}from"./support/decorators/messageBundle.js";import{vmEvent as b}from"./support/decorators/vmEvent.js";import{tsx as g}from"./support/jsxFactory.js";import{onResize as x}from"./support/widgetUtils.js";import{getCalciteThemeClass as j}from"../support/themeUtils.js";import{CSS as k}from"./TimeSlider/css.js";import T from"./TimeSlider/TimeSliderViewModel.js";const E=3,_=858,M=new s([{minor:new t({value:100,unit:"milliseconds"}),major:new t({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new t({value:500,unit:"milliseconds"}),major:new t({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new t({value:1,unit:"seconds"}),major:new t({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new t({value:2,unit:"seconds"}),major:new t({value:30,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new t({value:10,unit:"seconds"}),major:new t({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new t({value:15,unit:"seconds"}),major:new t({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:1,unit:"minutes"}),major:new t({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:5,unit:"minutes"}),major:new t({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:15,unit:"minutes"}),major:new t({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:1,unit:"hours"}),major:new t({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new t({value:6,unit:"hours"}),major:new t({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new t({value:1,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"long"}},{minor:new t({value:2,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"short"}},{minor:new t({value:3,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"short"}},{minor:new t({value:4,unit:"days"}),major:new t({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new t({value:1,unit:"weeks"}),major:new t({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:1,unit:"months"}),major:new t({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:2,unit:"months"}),major:new t({value:2,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:1,unit:"years"}),major:new t({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new t({value:2,unit:"years"}),major:new t({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new t({value:5,unit:"decades"}),major:new t({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:1,unit:"centuries"}),major:new t({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:2,unit:"centuries"}),major:new t({value:20,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:5,unit:"centuries"}),major:new t({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:10,unit:"centuries"}),major:new t({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:20,unit:"centuries"}),major:new t({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:50,unit:"centuries"}),major:new t({value:500,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:100,unit:"centuries"}),major:new t({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:200,unit:"centuries"}),major:new t({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:500,unit:"centuries"}),major:new t({value:5e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:1e3,unit:"centuries"}),major:new t({value:1e4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);let S=class extends h{constructor(e,t){super(e,t),this._ignoreNextSliderUpdate=!1,this._slider=new v({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1,thumbsConstrained:!1}),this._tickFormat=null,this.disabled=!1,this.iconClass=k.widgetIcon,this.icon=null,this.labelFormatFunction=null,this.messages=null,this.messagesCommon=null,this.tickConfigs=null,this.timeVisible=!1,this.viewModel=new T}initialize(){this.addHandles([o((()=>this._slider.values),(e=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const t=this.viewModel.valuesToTimeExtent(e);null!=this.timeExtent?null!=t?this.timeExtent.equals(t)||(this.timeExtent=t):this.timeExtent=null:null!=t&&(this.timeExtent=t)})),o((()=>this.effectiveStops),(()=>this._updateSliderSteps()),r)])}loadDependencies(){return w({action:()=>import("@esri/calcite-components/dist/components/calcite-action.js"),"action-menu":()=>import("@esri/calcite-components/dist/components/calcite-action-menu.js")})}destroy(){this._slider.destroy(),this._tickFormat=null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get effectiveStops(){return this.viewModel.effectiveStops}get fullTimeExtent(){return this.viewModel.fullTimeExtent}set fullTimeExtent(e){this.viewModel.fullTimeExtent=e}get interactive(){return!this.disabled&&"disabled"!==this.viewModel?.state}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){["auto","compact","wide"].includes(e)||(e="auto"),this._set("layout",e)}get loop(){return this.viewModel.loop}set loop(e){this.viewModel.loop=e}get mode(){return this.viewModel.mode}set mode(e){this.viewModel.mode=e}get playRate(){return this.viewModel.playRate}set playRate(e){this.viewModel.playRate=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(e){this.viewModel.timeExtent=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}static async getPropertiesFromWebMap(e,t){return T.getPropertiesFromWebMap(e,t)}next(){return this.viewModel.next()}play(){return this.viewModel.play()}previous(){return this.viewModel.previous()}stop(){return this.viewModel.stop()}render(){const{_slider:e,actions:t,domNode:s,effectiveStops:n,fullTimeExtent:o,interactive:r,messages:l,messagesCommon:u,mode:m,tickConfigs:d,timeExtent:p,timeVisible:v,viewModel:{state:h,timeExtentValues:w}}=this;if(null!=o){const{start:t,end:i}=o;if(null!=t&&null!=i){const s=t.getTime(),n=i.getTime(),a=e.min!==s||e.max!==n;if(a&&(e.min=s,e.max=n),null!=d)e.tickConfigs!==d&&(e.tickConfigs=d);else{const t=(n-s)/(e.trackElement?.offsetWidth||400),i=M.find((e=>e.minor.toMilliseconds()>E*t))??M.at(-1),o=this._tickFormat!==i&&null!=i;if(o&&(this._tickFormat=i),a||o){const t={mode:"position",values:this._getTickPositions(i.minor),labelsVisible:!1,tickCreatedFunction:(e,t)=>{t?.classList.add(k.sliderMinorTick)}},s={mode:"position",values:this._getTickPositions(i.major),labelsVisible:!0,tickCreatedFunction:(e,t)=>{t?.classList.add(k.sliderMajorTick)},labelFormatFunction:e=>c(e,i.format)};e.tickConfigs=[t,s]}}}}const f=null==this.fullTimeExtent||null==this.fullTimeExtent.start||null==this.fullTimeExtent.end||null==this.timeExtent||this.timeExtent.isAllTime||this.timeExtent.isEmpty||null!=this.timeExtent.start&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||null!=this.timeExtent.end&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(f)switch(this._ignoreNextSliderUpdate=!0,m){case"time-window":e.values=[e.min,e.max];break;case"instant":case"cumulative-from-end":e.values=[e.min];break;case"cumulative-from-start":e.values=[e.max]}else null!=w?i(e.values,w)||(e.values=w):e.values=null;e.disabled=!r;const y="ready"===h,b="playing"===h,T=f||!r||null==n||0===n.length,S="auto"===this.layout?s.clientWidth<_?"compact":"wide":this.layout,C=g("div",{class:k.animation},g("button",{"aria-disabled":T?"true":"false","aria-label":b?u.control.stop:u.control.play,bind:this,class:this.classes(k.esriWidgetButton,k.animationButton,T&&k.esriButtonDisabled),disabled:T,title:b?u.control.stop:u.control.play,onclick:this._playOrStopClick,type:"button"},g("div",{class:this.classes((y||T)&&k.animationPlay,b&&k.animationPause)}))),F=null!=this.labelFormatFunction?g("div",{key:"extent",bind:this,class:k.timeExtentDate,"data-type":"extent","data-layout":S,"data-date":a(p,(e=>[e.start,e.end])),afterCreate:this._createLabel,afterUpdate:this._createLabel}):null==p||null!=p&&p.isAllTime?[g("div",{class:this.classes(k.warning,k.warningIcon)}),g("div",{key:"warning-text",class:k.warningText},l.noTimeExtent)]:p.isEmpty?[g("div",{class:this.classes(k.warning,k.warningIcon)}),g("div",{key:"warning-text",class:k.warningText},l.emptyTimeExtent)]:[null!=p.start&&g("div",{key:"start-date-group",class:k.timeExtentGroup},g("div",{key:"start-date",class:k.timeExtentDate},this._formatDate(p.start)),v&&g("div",{key:"start-time",class:k.timeExtentTime},this._formatTime(p.start))),null!=p.start&&null!=p.end&&p.start.getTime()!==p.end.getTime()&&g("div",{key:"separator",class:k.timeExtentSeparator},"–"),null!=p.end&&(null==p.start||p.start.getTime()!==p.end.getTime())&&g("div",{key:"end-date-group",class:k.timeExtentGroup},g("div",{key:"end-date",class:k.timeExtentDate},this._formatDate(p.end)),v&&g("div",{key:"end-time",class:k.timeExtentTime},this._formatTime(p.end)))],D=g("div",{class:this.classes(k.timeExtent,!r&&k.esriButtonDisabled)},[F]),B=null!=this.labelFormatFunction?g("div",{key:"min-date",bind:this,class:k.minDate,"data-date":a(o,(e=>e.start)),"data-type":"min","data-layout":S,afterCreate:this._createLabel,afterUpdate:this._createLabel}):null!=o&&null!=o.start&&[g("div",{key:"min-date",class:k.minDate},this._formatDate(o.start)),v&&g("div",{key:"min-time",class:k.minTime},this._formatTime(o.start))],L=g("div",{class:this.classes(k.min,!r&&k.esriButtonDisabled)},[B]),U=g("div",{class:k.slider},e.render()),W=null!=this.labelFormatFunction?g("div",{key:"max-date",bind:this,class:k.maxDate,"data-date":a(o,(e=>e.end)),"data-type":"max","data-layout":S,afterCreate:this._createLabel,afterUpdate:this._createLabel}):null!=o&&null!=o.end&&[g("div",{key:"max-date",class:k.maxDate},this._formatDate(o.end)),v&&g("div",{key:"max-time",class:k.maxTime},this._formatTime(o.end))],R=g("div",{class:this.classes(k.max,!r&&k.esriButtonDisabled)},[W]),I=g("div",{class:k.previous},g("button",{"aria-disabled":T?"true":"false","aria-label":u.pagination.previous,bind:this,class:this.classes(k.esriWidgetButton,k.previousButton,(b||T)&&k.esriButtonDisabled),disabled:T,title:u.pagination.previous,onclick:this._previousClick,type:"button"},g("div",{class:k.previousIcon}))),A=g("div",{class:k.next},g("button",{"aria-disabled":T?"true":"false","aria-label":u.pagination.next,bind:this,class:this.classes(k.esriWidgetButton,k.nextButton,(b||T)&&k.esriButtonDisabled),disabled:T,title:u.pagination.next,onclick:this._nextClick,type:"button"},g("div",{class:k.nextIcon}))),P=t?.length>0,V=P&&g("div",{class:k.actions,title:u.options},g("calcite-action-menu",{label:u.options,class:k.actionsButton},t.toArray().map((e=>g("calcite-action",{bind:this,icon:e.icon,id:e.id,onclick:()=>this.viewModel.triggerAction(e),text:e.title,textEnabled:!0})))));return g("div",{class:this.classes(k.timeSlider,k.esriWidget,`${k.timeSliderMode}${m}`,`${k.timeSliderLayout}${S}`,!r&&k.esriDisabled,f&&k.timeSliderOutOfBounds,P&&k.hasActions,j()),afterCreate:e=>{this.addHandles(x(e,(()=>this.scheduleRender())))},"aria-label":l.widgetLabel},"wide"===S&&g("div",{class:k.timeSliderRow},g("div",{class:k.playbackControls},[C,D,L,U,R,I,A]),V),"compact"===S&&[g("div",{key:"time-slider-row-1",class:k.timeSliderRow},[D,V]),g("div",{key:"time-slider-row-2",class:k.timeSliderRow},[U]),g("div",{key:"time-slider-row-3",class:k.timeSliderRow},[L,I,C,A,R])])}updateWebDocument(e){this.viewModel?.updateWebDocument(e)}_createLabel(e){if(null==this.labelFormatFunction)return;const t=e.getAttribute("data-type"),i=e.getAttribute("data-layout"),s=e["data-date"];this.labelFormatFunction(s,t,e,i)}_getTickPositions(e){const{fullTimeExtent:t}=this;if(null==t||null==t.start||null==t.end)return[];const{start:i,end:s}=t,n=[],{value:a,unit:o}=e;let r=l(i,o);for(;r.getTime()<=s.getTime();)r.getTime()>=i.getTime()&&n.push(r.getTime()),r=u(r,a,o);return n}_formatDate(e){return e?c(e,p("short-date")):null}_formatTime(e){return e?c(e,p("long-time")):null}_updateSliderSteps(){this._slider.steps=null!=this.effectiveStops&&this.effectiveStops.length>0?this.effectiveStops.map((e=>e.getTime())):null}_playOrStopClick(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:n(this.viewModel.state)}}_previousClick(){this.viewModel.previous()}_nextClick(){this.viewModel.next()}};e([m()],S.prototype,"actions",null),e([m()],S.prototype,"disabled",void 0),e([m()],S.prototype,"effectiveStops",null),e([m()],S.prototype,"fullTimeExtent",null),e([m()],S.prototype,"iconClass",void 0),e([m()],S.prototype,"icon",void 0),e([m({readOnly:!0})],S.prototype,"interactive",null),e([m()],S.prototype,"label",null),e([m()],S.prototype,"labelFormatFunction",void 0),e([m({value:"auto"})],S.prototype,"layout",null),e([m()],S.prototype,"loop",null),e([m(),y("esri/widgets/TimeSlider/t9n/TimeSlider")],S.prototype,"messages",void 0),e([m(),y("esri/t9n/common")],S.prototype,"messagesCommon",void 0),e([m()],S.prototype,"mode",null),e([m()],S.prototype,"playRate",null),e([m()],S.prototype,"stops",null),e([m()],S.prototype,"tickConfigs",void 0),e([m()],S.prototype,"timeExtent",null),e([m({nonNullable:!0})],S.prototype,"timeVisible",void 0),e([m()],S.prototype,"view",null),e([m({type:T}),b("trigger-action")],S.prototype,"viewModel",void 0),e([f()],S.prototype,"_playOrStopClick",null),e([f()],S.prototype,"_previousClick",null),e([f()],S.prototype,"_nextClick",null),S=e([d("esri.widgets.TimeSlider")],S);const C=S;export{C as default};
