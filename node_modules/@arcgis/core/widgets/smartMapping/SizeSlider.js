/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import t from"../../Color.js";import{property as s}from"../../core/accessorSupport/decorators/property.js";import{cast as i}from"../../core/accessorSupport/decorators/cast.js";import"../../core/arrayUtils.js";import"../../core/has.js";import{subclass as a}from"../../core/accessorSupport/decorators/subclass.js";import r from"../../renderers/visualVariables/SizeVariable.js";import o from"../../renderers/visualVariables/support/SizeStop.js";import{SmartMappingSliderBase as l}from"./SmartMappingSliderBase.js";import n from"./SizeSlider/SizeSliderViewModel.js";import{getSizesFromVariable as d,getFillFromColor as p,getDynamicPathForSizeStops as m,getPathForSizeStops as u}from"./support/utils.js";import{storeNode as c}from"../support/widgetUtils.js";import{messageBundle as h}from"../support/decorators/messageBundle.js";import{tsx as g}from"../support/jsxFactory.js";var v;const b="esri-size-slider",z={base:b,rampElement:`${b}__ramp`,sliderContainer:`${b}__slider-container`,histogramContainer:`${b}__histogram-container`,zoomCapTop:`${b}__zoom-cap-top`,zoomCapBottom:`${b}__zoom-cap-bottom`,zoomCapLine:`${b}__zoom-cap-line`,zoomCapMask:`${b}__zoom-cap-mask`,zoomCapUnderline:`${b}__zoom-cap-underline`,primaryHandle:`${b}--primary-handle`,track:`${b}--interactive-track`,esriWidget:"esri-widget",esriWidgetPanel:"esri-widget--panel",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"},y={trackFillColor:new t([149,149,149]),trackBackgroundColor:new t([224,224,224])};let S=v=class extends l{constructor(e,t){super(e,t),this._maxRampFillWidth=1,this._minRampFillWidth=.2,this._rampNode=null,this.messages=null,this.style={...y},this.viewModel=new n}get handlesSyncedToPrimary(){return this.viewModel.handlesSyncedToPrimary}set handlesSyncedToPrimary(e){this.viewModel.handlesSyncedToPrimary=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get persistSizeRangeEnabled(){return this.viewModel.persistSizeRangeEnabled}set persistSizeRangeEnabled(e){this.viewModel.persistSizeRangeEnabled=e}get primaryHandleEnabled(){return this.viewModel.primaryHandleEnabled}set primaryHandleEnabled(e){this.viewModel.primaryHandleEnabled=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}castStyle(e){return{...y,...e}}static fromRendererResult(e,t){const{visualVariables:s,statistics:i}=e,{avg:a,stddev:r}=i,o=s[0],[l,n]=d(o),p=e.renderer.authoringInfo.visualVariables[0],m=p.minSliderValue,u=p.maxSliderValue;return new v({max:u,min:m,stops:[{value:o.minDataValue,size:n},{value:o.maxDataValue,size:l}],histogramConfig:{average:a,standardDeviation:r,bins:t?t.bins:[]}})}updateFromRendererResult(e,t){const{visualVariables:s,statistics:i}=e,{avg:a,stddev:r}=i,o=s[0],[l,n]=d(o),p=e.renderer.authoringInfo.visualVariables[0],m=p.minSliderValue,u=p.maxSliderValue;this.set({max:u,min:m,stops:[{value:o.minDataValue,size:n},{value:o.maxDataValue,size:l}],histogramConfig:{average:a,standardDeviation:r,bins:t?t.bins:[]}})}updateVisualVariable(e){const t=e.clone(),{stops:s}=this;if(!e||!s)return null;if(t.stops)return t.stops=s,t;const i=s[0],a=s[s.length-1];let o=t.maxSize,l=t.minSize;if(o instanceof r){const e=o.stops,t=a.size/e[0].size,s=e.map((e=>(e.size*=t,e)));o.stops=s}else o=a.size;if(l instanceof r){const e=l.stops,t=i.size/e[0].size,s=e.map((e=>(e.size*=t,e)));l.stops=s}else l=i.size;return t.set({maxDataValue:a.value,minDataValue:i.value,maxSize:o,minSize:l}),t}updateFromVisualVariable(e){if(!e)return;const{maxDataValue:t,minDataValue:s,stops:i}=e;if(i)this.stops=i;else{const[i,a]=d(e);this.stops=[new o({value:s,size:a}),new o({value:t,size:i})]}}render(){const{label:e,primaryHandleEnabled:t,state:s,visibleElements:i}=this,a="disabled"===s,r=this.classes(z.base,z.esriWidget,z.esriWidgetPanel,{[z.disabled]:a,[z.primaryHandle]:t,[z.track]:!!i.interactiveTrack});return g("div",{"aria-label":e,class:r},a?null:this.renderContent(this.renderRamp(),z.sliderContainer,z.histogramContainer))}renderRamp(){const{style:{trackBackgroundColor:e},zoomOptions:t}=this;return g("div",{afterCreate:c,bind:this,class:z.rampElement,"data-node-ref":"_rampNode"},g("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},g("rect",{x:"0",y:"0",fill:p(e),height:"100%",width:"100%"}),this.renderPath()),t?this.renderZoomCaps():null)}renderPath(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:t=0}=this._rampNode;if(null==e||null==t)return;const{primaryHandleEnabled:s,stops:i,style:{trackFillColor:a},values:r,viewModel:{max:o,min:l},_maxRampFillWidth:n,_minRampFillWidth:d}=this,c=[n,d];i[0].size<i[i.length-1].size&&c.reverse();const h=r.slice().sort(((e,t)=>e>t?1:-1)),[v,b]=c,[z,y]=h,S=s?m({max:o,min:l,pathHeight:e,pathWidth:t,stops:i,padding:b}):u({bottomValue:z,bottomWidth:v,max:o,min:l,pathHeight:e,pathWidth:t,topValue:y,topWidth:b});return g("path",{d:S,fill:p(a)})}};e([s()],S.prototype,"handlesSyncedToPrimary",null),e([s()],S.prototype,"label",null),e([s(),h("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],S.prototype,"messages",void 0),e([s()],S.prototype,"persistSizeRangeEnabled",null),e([s()],S.prototype,"primaryHandleEnabled",null),e([s()],S.prototype,"stops",null),e([s()],S.prototype,"style",void 0),e([i("style")],S.prototype,"castStyle",null),e([s()],S.prototype,"viewModel",void 0),S=v=e([a("esri.widgets.smartMapping.SizeSlider")],S);const f=S;export{f as default};
