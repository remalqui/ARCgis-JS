/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import{on as t}from"../../../core/events.js";import{removeMaybe as o,destroyMaybe as s,applySome as r}from"../../../core/maybe.js";import{isMeasurementSystem as i}from"../../../core/unitUtils.js";import{property as n}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/accessorSupport/ensureType.js";import"../../../core/arrayUtils.js";import"../../../core/has.js";import{subclass as l}from"../../../core/accessorSupport/decorators/subclass.js";import a from"../../Widget.js";import{SETTINGS_CSS as c}from"../css.js";import p from"../../support/Popover.js";import{getDir as h}from"../../support/widgetUtils.js";import{messageBundle as u}from"../../support/decorators/messageBundle.js";import{tsx as m}from"../../support/jsxFactory.js";let _=class extends a{constructor(e,t){super(e,t),this._popover=null,this._buttonElement=null,this._focusOutElement=null,this._requestFocusOnCreate=!1}destroy(){this._destroyPopover()}render(){const{unitSelector:e,uniformChartScalingToggle:t}=this.visibleElements;if(!e&&!t)return m("div",{key:`${this.id}-empty`});const o=null!=this._popover&&this._popover.open?this._messages.hideSettings:this._messages.showSettings;return m("button",{class:c.base,title:o,bind:this,afterCreate:this._initializePopover,onclick:this._togglePopover,"aria-label":o,type:"button"})}_initializePopover(e){this._destroyPopover(),this._buttonElement=e,this._popover=new p({owner:this,placement:"bottom-end",offset:[0,0],anchorElement:e,renderContentFunction:()=>this._renderPopoverContent()})}_destroyPopover(){this._focusOutElement=o(this._focusOutElement),this._popover=s(this._popover)}_renderPopoverContent(){const{unitSelector:e,uniformChartScalingToggle:t}=this.visibleElements;return m("div",{class:c.popoverContent,dir:h(this._buttonElement),bind:this,afterCreate:this._onPopoverContentAfterCreate},e&&this._renderUnitSelector(),t&&this._renderUniformChartScalingToggle())}_renderUnitSelector(){const{unit:e,unitOptions:t}=this.viewModel,o=this._messagesUnits;return m("label",{key:"unit-selector-label",class:c.selectLabel},this._messages.unitSelectLabel,m("select",{class:c.select,value:e,bind:this,onchange:this._onUnitChange,afterCreate:this._onUnitSelectAfterCreate},t.map((e=>m("option",{key:e,value:e},i(e)?o.systems[e]:o.units[e].pluralCapitalized)))))}_onUnitChange(e){this.viewModel.unit=e.target.value}_onUnitSelectAfterCreate(e){this._requestFocusOnCreate&&(this._requestFocusOnCreate=!1,e.focus())}_renderUniformChartScalingToggle(){const e=this._messages,t=this.viewModel.uniformChartScaling,o=t?e.uniformChartScalingDisable:e.uniformChartScalingEnable;return m("label",{key:"uniform-chart-scaling-label",class:c.checkboxLabel,onmousedown:f},m("input",{class:this.classes(c.checkbox,c.uniformChartScalingCheckbox),type:"checkbox",checked:t,title:o,"aria-label":o,bind:this,onchange:this._onUniformChartScalingChange}),e.uniformChartScalingLabel)}_onUniformChartScalingChange(e){this.viewModel.uniformChartScaling=e.target.checked}_togglePopover(e){null!=this._popover&&this._popover.open?this._closePopover():this._openPopover()}_openPopover(){r(this._popover,(e=>e.open=!0)),this._requestFocusOnCreate=!0}_closePopover({focusOnButton:e=!0}={}){r(this._popover,(e=>e.open=!1)),e&&r(this._buttonElement,(e=>e.focus()))}_onPopoverContentAfterCreate(e){o(this._focusOutElement),this._focusOutElement=t(e,"focusout",(({relatedTarget:t})=>{const o=e.contains(t),s=t===this._buttonElement;o||s||this._closePopover({focusOnButton:!1})}))}};function f(e){e.preventDefault()}e([n()],_.prototype,"viewModel",void 0),e([n()],_.prototype,"visibleElements",void 0),e([n(),u("esri/widgets/ElevationProfile/t9n/ElevationProfile")],_.prototype,"_messages",void 0),e([n(),u("esri/core/t9n/Units")],_.prototype,"_messagesUnits",void 0),_=e([l("esri.widgets.ElevationProfile.SettingsButton")],_);export{_ as SettingsButton};
