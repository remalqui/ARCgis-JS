/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{deprecatedProperty as t}from"../core/deprecate.js";import r from"../core/Logger.js";import{watch as s}from"../core/reactiveUtils.js";import{createScreenPoint as i}from"../core/screenUtils.js";import{property as o}from"../core/accessorSupport/decorators/property.js";import"../core/accessorSupport/ensureType.js";import"../core/arrayUtils.js";import"../core/has.js";import{subclass as l}from"../core/accessorSupport/decorators/subclass.js";import{formatNumber as a}from"../intl/number.js";import{defaultUnitPropertyMetadata as n}from"../properties/defaultUnit.js";import c from"./Widget.js";import{CSS as d}from"./ScaleBar/css.js";import p from"./ScaleBar/ScaleBarViewModel.js";import"./support/widgetUtils.js";import{messageBundle as u}from"./support/decorators/messageBundle.js";import{tsx as m}from"./support/jsxFactory.js";function h(e,t){return a(e,{style:"unit",unit:t,unitDisplay:"short"})}const v="esri.widgets.ScaleBar",f=r.getLogger(v);let w=class extends c{constructor(e,t){super(e,t),this.messages=null,this.style="line",this.viewModel=new p}initialize(){this.addHandles(s((()=>{const{view:e}=this;return[e?.stationary,e?.center,e?.scale,e?.zoom]}),(([e])=>{e&&this.scheduleRender()})))}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get unit(){return this._defaultUnit}set unit(e){"non-metric"===e&&t(f,"unit",{replacement:"Please use 'imperial' instead of 'non-metric'.",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-ScaleBar.html#unit",version:"4.27",warnOnce:!0}),this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e="disabled"===this.viewModel.state,t={[d.disabled]:e};let r,s;if(!e){const{unit:e,style:t}=this,i="metric"===e||"dual"===e,o=100,l="dual"===e?"line":t;if("imperial"===e||"non-metric"===e||"dual"===e){const e=this.viewModel.getScaleBarProperties(o,"imperial");e&&(s="ruler"===l?this._renderRuler(e):this._renderLine(e,"bottom"))}if(i){const e=this.viewModel.getScaleBarProperties(o,"metric");e&&(r="ruler"===l?this._renderRuler(e):this._renderLine(e,"top"))}}return m("div",{afterCreate:this._handleRootCreateOrUpdate,afterUpdate:this._handleRootCreateOrUpdate,bind:this,class:this.classes(d.base,t)},r,s)}_renderRuler(e){const{length:t,unit:r,value:s}=e,i=Math.round(t),o=h(s,r);return m("div",{class:this.classes(d.barContainer,d.rulerBarContainer),key:d.rulerBarContainer},m("div",{class:d.ruler,styles:{width:`${i}px`}},m("div",{class:d.rulerBlock}),m("div",{class:d.rulerBlock}),m("div",{class:d.rulerBlock}),m("div",{class:d.rulerBlock})),m("div",{class:this.classes(d.labelContainer,d.rulerLabelContainer)},m("div",{class:d.label},"0"),m("div",{class:d.label},o)))}_renderLine(e,t){const{length:r,unit:s,value:i}=e,o=Math.round(r),l=h(i,s),a={[d.topLabelContainer]:"top"===t,[d.bottomLabelContainer]:"bottom"===t},n=m("div",{class:this.classes(d.labelContainer,d.lineLabelContainer,a),key:d.labelContainer},m("div",{class:d.label},l)),c={[d.topLine]:"top"===t,[d.bottomLine]:"bottom"===t},p=m("div",{class:this.classes(d.line,c),key:d.line,styles:{width:`${o}px`}});return m("div",{class:this.classes(d.barContainer,d.lineBarContainer),key:d.lineBarContainer},[p,n])}_handleRootCreateOrUpdate(e){if(!this.viewModel)return;const{scaleComputedFrom:t}=this.viewModel,r=e.getBoundingClientRect(),s=r.left+window.pageXOffset,o=r.top+window.pageYOffset,l=i(s,o);(l.x!==t.x||l.y!==t.y)&&(this.viewModel.scaleComputedFrom=l)}};e([o(n)],w.prototype,"_defaultUnit",void 0),e([o()],w.prototype,"label",null),e([o(),u("esri/widgets/ScaleBar/t9n/ScaleBar")],w.prototype,"messages",void 0),e([o({type:["ruler","line"]})],w.prototype,"style",void 0),e([o({type:["metric","imperial","dual","non-metric"]})],w.prototype,"unit",null),e([o()],w.prototype,"view",null),e([o()],w.prototype,"viewModel",void 0),w=e([l(v)],w);const b=w;export{b as default};
