/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"../../geometry.js";import t from"../../core/Accessor.js";import{createScreenPoint as r}from"../../core/screenUtils.js";import{convertUnit as s}from"../../core/unitUtils.js";import{property as i}from"../../core/accessorSupport/decorators/property.js";import"../../core/accessorSupport/ensureType.js";import"../../core/arrayUtils.js";import"../../core/has.js";import{subclass as o}from"../../core/accessorSupport/decorators/subclass.js";import{isSupported as n,geodesicLengths as a}from"../../geometry/support/geodesicUtils.js";import{straightLineDensify as c}from"../../geometry/support/normalizeUtils.js";import{isValid as l,getInfo as m}from"../../geometry/support/spatialReferenceUtils.js";import{webMercatorToGeographic as u}from"../../geometry/support/webMercatorUtils.js";import p from"../../geometry/support/WKIDUnitConversion.js";import d from"../../geometry/SpatialReference.js";import f from"../../geometry/Polyline.js";import h from"../../geometry/Point.js";function w(e){return e>.5?{min:.5,max:1}:e>.2?{min:.2,max:.5}:{min:.1,max:.2}}function g(e,t){switch(t){case"metric":return e>1e3?{distance:s(e,"meters","kilometers"),unit:"kilometer"}:e>1?{distance:e,unit:"meter"}:e>.01?{distance:s(e,"meters","centimeters"),unit:"centimeter"}:{distance:s(e,"meters","millimeters"),unit:"millimeter"};case"imperial":case"non-metric":return e>1609.344?{distance:s(e,"meters","miles"),unit:"mile"}:e>.3048?{distance:s(e,"meters","feet"),unit:"foot"}:{distance:s(e,"meters","inches"),unit:"inch"}}}function y(e){const{isWebMercator:t,wkt:r}=e;return t||(r?.includes("WGS_1984_Web_Mercator")??!1)}function j(e){const{wkid:t,wkt:r}=e;if(null!=t&&null!=p[t])return p.values[p[t]];if(null!=r){const e=r.lastIndexOf(",")+1,t=r.lastIndexOf("]]");return parseFloat(r.substring(e,t))}return 1}function S({state:{paddedViewState:e},spatialReference:t,width:r}){return t.isWrappable&&e.worldScreenWidth<r}function v(e,t){const{x:r,y:s}=e?u(t,!0):t;return[r,s]}let b=class extends t{constructor(e){super(e),this.scaleComputedFrom=r(),this.view=null}get state(){return this.view?.ready&&"2d"===this.view?.type?"ready":"disabled"}getScaleBarProperties(e,t){if("disabled"===this.state||isNaN(e)||!t||!this.view)return null;const r=this._getDistanceInMeters();return null==r?null:this._getScaleBarProps(e,r,t)}_getDistanceInMeters(){const{state:e,spatialReference:t}=this.view;if(!l(t))return null;const{isGeographic:r}=t,s=y(t);if(!r&&!s){return e.extent.width*j(t)}const[i,o]=this._getScaleMeasuringPoints(),m=s||r&&!n(t)?d.WGS84:t,u=new f({paths:[[v(s,i),v(s,o)]],spatialReference:m}),p=c(u,10);let h;try{[h]=a([p],"meters")}catch{return null}return h}_getScaleMeasuringPoints(){const e=this.view,{width:t,height:s,position:i,spatialReference:o}=e;if(S(e)){const e=m(o),{valid:t}=e;return[new h(t[0],0,o),new h(t[1],0,o)]}let n=this.scaleComputedFrom.y-i[1];n>s?n=s:n<0&&(n=0);const a=r(0,n),c=r(t,n);return[e.toMap(a),e.toMap(c)]}_getScaleBarProps(e,t,r){const s=this.view,i=e*t/(S(s)?s.state.paddedViewState.worldScreenWidth:s.width);if(i<.001)return null;const o=g(i,r),{distance:n,unit:a}=o;let c=n,l=0;for(;c>=1;)c/=10,l++;const{min:m,max:u}=w(c),p=u/c>=c/m?m:u;return{length:e*(p/c),value:10**l*p,unit:a}}};e([i()],b.prototype,"scaleComputedFrom",void 0),e([i({readOnly:!0})],b.prototype,"state",null),e([i()],b.prototype,"view",void 0),b=e([o("esri.widgets.Scalebar.ScaleBarViewModel")],b);const x=b;export{x as default};
