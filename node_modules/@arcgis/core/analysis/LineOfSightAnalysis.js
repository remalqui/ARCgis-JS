/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"./Analysis.js";import r from"./LineOfSightAnalysisObserver.js";import o from"./LineOfSightAnalysisTarget.js";import s from"../core/Collection.js";import{referenceSetter as i,castForReferenceSetter as n}from"../core/collectionUtils.js";import{applySome as l}from"../core/maybe.js";import{watch as p,syncAndInitial as a}from"../core/reactiveUtils.js";import{property as u}from"../core/accessorSupport/decorators/property.js";import"../core/accessorSupport/ensureType.js";import"../core/arrayUtils.js";import"../core/has.js";import{subclass as c}from"../core/accessorSupport/decorators/subclass.js";import{projectOrLoad as m}from"../geometry/projection.js";import{fromValues as g,expandWithVec3 as y,toExtent as f}from"../geometry/support/aaBoundingBox.js";import{getGeometryEffectiveElevationMode as h}from"../support/elevationInfoUtils.js";const d=s.ofType(o);let v=class extends t{constructor(e){super(e),this.type="line-of-sight",this.observer=null,this.extent=null}initialize(){this.addHandles(p((()=>this._computeExtent()),(e=>{null!=e&&null!=e.pending||this._set("extent",null!=e?e.extent:null)}),a))}get targets(){return this._get("targets")||new d}set targets(e){this._set("targets",i(e,this.targets,d))}get spatialReference(){return null!=this.observer&&null!=this.observer.position?this.observer.position.spatialReference:null}get requiredPropertiesForEditing(){return[l(this.observer,(e=>e.position))]}async waitComputeExtent(){const e=this._computeExtent();return null!=e?e.pending:Promise.resolve()}_computeExtent(){const e=this.spatialReference;if(null==this.observer||null==this.observer.position||null==e)return null;const t=e=>"absolute-height"===h(e.position,e.elevationInfo),r=this.observer.position,o=g(r.x,r.y,r.z,r.x,r.y,r.z);for(const i of this.targets)if(null!=i.position){const t=m(i.position,e);if(null!=t.pending)return{pending:t.pending,extent:null};if(null!=t.geometry){const{x:e,y:r,z:s}=t.geometry;y(o,[e,r,s])}}const s=f(o,e);return t(this.observer)&&this.targets.every(t)||(s.zmin=void 0,s.zmax=void 0),{pending:null,extent:s}}clear(){this.observer=null,this.targets.removeAll()}};e([u({type:["line-of-sight"]})],v.prototype,"type",void 0),e([u({type:r,json:{read:!0,write:!0}})],v.prototype,"observer",void 0),e([u({cast:n,type:d,nonNullable:!0,json:{read:!0,write:!0}})],v.prototype,"targets",null),e([u({value:null,readOnly:!0})],v.prototype,"extent",void 0),e([u({readOnly:!0})],v.prototype,"spatialReference",null),e([u({readOnly:!0})],v.prototype,"requiredPropertiesForEditing",null),v=e([c("esri.analysis.LineOfSightAnalysis")],v);const j=v;export{j as default};
